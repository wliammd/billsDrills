<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 15 Shape of Data | Bill’s Drills Book</title>
  <meta name="description" content="Chapter 15 Shape of Data | Bill’s Drills Book" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 15 Shape of Data | Bill’s Drills Book" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="https://github.com/wliammd/billsDrills" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 15 Shape of Data | Bill’s Drills Book" />
  
  
  

<meta name="author" content="William McDonald" />


<meta name="date" content="2020-09-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dimensionalityreduction.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Bill's Drills Book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Drills: Part of Every Healthy Intellectual Diet</a></li>
<li class="chapter" data-level="2" data-path="bookdownplan.html"><a href="bookdownplan.html"><i class="fa fa-check"></i><b>2</b> bookdown Tips for This Document</a><ul>
<li class="chapter" data-level="2.1" data-path="bookdownplan.html"><a href="bookdownplan.html#basic-conventions"><i class="fa fa-check"></i><b>2.1</b> Basic conventions</a></li>
<li class="chapter" data-level="2.2" data-path="bookdownplan.html"><a href="bookdownplan.html#referencing-other-parts-of-the-document"><i class="fa fa-check"></i><b>2.2</b> Referencing other parts of the document</a></li>
<li class="chapter" data-level="2.3" data-path="bookdownplan.html"><a href="bookdownplan.html#inserting-pictures"><i class="fa fa-check"></i><b>2.3</b> Inserting pictures</a></li>
<li class="chapter" data-level="2.4" data-path="bookdownplan.html"><a href="bookdownplan.html#referencing-citations"><i class="fa fa-check"></i><b>2.4</b> Referencing citations:</a></li>
<li class="chapter" data-level="2.5" data-path="bookdownplan.html"><a href="bookdownplan.html#nifty-test-figure."><i class="fa fa-check"></i><b>2.5</b> Nifty test figure.</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dataexploration.html"><a href="dataexploration.html"><i class="fa fa-check"></i><b>3</b> Data Exploration</a><ul>
<li class="chapter" data-level="3.1" data-path="dataexploration.html"><a href="dataexploration.html#counting-things.-the-naming-of-parts."><i class="fa fa-check"></i><b>3.1</b> Counting things. The naming of parts.</a></li>
<li class="chapter" data-level="3.2" data-path="dataexploration.html"><a href="dataexploration.html#fct_infreq"><i class="fa fa-check"></i><b>3.2</b> fct_infreq</a></li>
<li class="chapter" data-level="3.3" data-path="dataexploration.html"><a href="dataexploration.html#weight-weight-dont-tell-me"><i class="fa fa-check"></i><b>3.3</b> Weight weight, don’t tell me!</a></li>
<li class="chapter" data-level="3.4" data-path="dataexploration.html"><a href="dataexploration.html#summarize-is-another-very-useful-function"><i class="fa fa-check"></i><b>3.4</b> Summarize is another very useful function:</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sampling.html"><a href="sampling.html"><i class="fa fa-check"></i><b>4</b> Sampling</a><ul>
<li class="chapter" data-level="4.1" data-path="sampling.html"><a href="sampling.html#think-about-throwing-a-bunch-of-dice."><i class="fa fa-check"></i><b>4.1</b> Think about throwing a bunch of dice.</a></li>
<li class="chapter" data-level="4.2" data-path="sampling.html"><a href="sampling.html#a-keen-way-to-divide-up-a-dataset-into-testing-and-training-components."><i class="fa fa-check"></i><b>4.2</b> A keen way to divide up a dataset into testing and training components.</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="factorpractice.html"><a href="factorpractice.html"><i class="fa fa-check"></i><b>5</b> Factor Practice</a><ul>
<li class="chapter" data-level="5.1" data-path="factorpractice.html"><a href="factorpractice.html#the-basic-structure"><i class="fa fa-check"></i><b>5.1</b> The basic structure</a></li>
<li class="chapter" data-level="5.2" data-path="factorpractice.html"><a href="factorpractice.html#not-all-nominal-data-is-a-factor"><i class="fa fa-check"></i><b>5.2</b> Not all nominal data is a factor</a></li>
<li class="chapter" data-level="5.3" data-path="factorpractice.html"><a href="factorpractice.html#making-variables-into-factors"><i class="fa fa-check"></i><b>5.3</b> Making variables into factors</a></li>
<li class="chapter" data-level="5.4" data-path="factorpractice.html"><a href="factorpractice.html#inspecting-factors"><i class="fa fa-check"></i><b>5.4</b> Inspecting factors</a></li>
<li class="chapter" data-level="5.5" data-path="factorpractice.html"><a href="factorpractice.html#fct_lump"><i class="fa fa-check"></i><b>5.5</b> fct_lump()</a></li>
<li class="chapter" data-level="5.6" data-path="factorpractice.html"><a href="factorpractice.html#fct_infreq-and-fct_rev"><i class="fa fa-check"></i><b>5.6</b> fct_infreq() and fct_rev()</a></li>
<li class="chapter" data-level="5.7" data-path="factorpractice.html"><a href="factorpractice.html#additional-practice"><i class="fa fa-check"></i><b>5.7</b> Additional practice</a></li>
<li class="chapter" data-level="5.8" data-path="factorpractice.html"><a href="factorpractice.html#reordering-factors"><i class="fa fa-check"></i><b>5.8</b> Reordering Factors</a><ul>
<li class="chapter" data-level="5.8.1" data-path="factorpractice.html"><a href="factorpractice.html#improving-legibility-change-the-linetype"><i class="fa fa-check"></i><b>5.8.1</b> Improving legibility: change the linetype</a></li>
<li class="chapter" data-level="5.8.2" data-path="factorpractice.html"><a href="factorpractice.html#fct_reorder2-another-way-to-improve-legibility"><i class="fa fa-check"></i><b>5.8.2</b> fct_reorder2(): another way to improve legibility</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="crossingtrial.html"><a href="crossingtrial.html"><i class="fa fa-check"></i><b>6</b> Crossing Trial</a></li>
<li class="chapter" data-level="7" data-path="changenames.html"><a href="changenames.html"><i class="fa fa-check"></i><b>7</b> By Any Other Name</a><ul>
<li class="chapter" data-level="7.1" data-path="changenames.html"><a href="changenames.html#a-financial-example"><i class="fa fa-check"></i><b>7.1</b> A financial example</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="correlation.html"><a href="correlation.html"><i class="fa fa-check"></i><b>8</b> Correlation Plots</a></li>
<li class="chapter" data-level="9" data-path="ifelsecasewhen.html"><a href="ifelsecasewhen.html"><i class="fa fa-check"></i><b>9</b> if_else() and case_when(): Comparison</a><ul>
<li class="chapter" data-level="9.1" data-path="ifelsecasewhen.html"><a href="ifelsecasewhen.html#case_when"><i class="fa fa-check"></i><b>9.1</b> case_when()</a></li>
<li class="chapter" data-level="9.2" data-path="ifelsecasewhen.html"><a href="ifelsecasewhen.html#compare-this-with-if_else"><i class="fa fa-check"></i><b>9.2</b> Compare this with if_else()</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="subset.html"><a href="subset.html"><i class="fa fa-check"></i><b>10</b> Subsetting</a><ul>
<li class="chapter" data-level="10.1" data-path="subset.html"><a href="subset.html#subsetting-using-brackets"><i class="fa fa-check"></i><b>10.1</b> Subsetting using brackets</a></li>
<li class="chapter" data-level="10.2" data-path="subset.html"><a href="subset.html#subset-using-brackets-by-omitting-the-rows-and-columns-we-dont-want"><i class="fa fa-check"></i><b>10.2</b> Subset using brackets by omitting the rows and columns we don’t want</a></li>
<li class="chapter" data-level="10.3" data-path="subset.html"><a href="subset.html#subset-using-brackets-in-combination-with-the-which-function-and-the-in-operator"><i class="fa fa-check"></i><b>10.3</b> Subset using brackets in combination with the which() function and the %in% operator</a></li>
<li class="chapter" data-level="10.4" data-path="subset.html"><a href="subset.html#subset-using-the-subset-function"><i class="fa fa-check"></i><b>10.4</b> Subset using the subset() function</a></li>
<li class="chapter" data-level="10.5" data-path="subset.html"><a href="subset.html#subset-using-dyplyrs-filter-and-select"><i class="fa fa-check"></i><b>10.5</b> Subset using dyplyr’s filter() and select()</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="simulating-data.html"><a href="simulating-data.html"><i class="fa fa-check"></i><b>11</b> Simulating data</a><ul>
<li class="chapter" data-level="11.1" data-path="simulating-data.html"><a href="simulating-data.html#sample"><i class="fa fa-check"></i><b>11.1</b> Sample()</a></li>
<li class="chapter" data-level="11.2" data-path="simulating-data.html"><a href="simulating-data.html#replicate"><i class="fa fa-check"></i><b>11.2</b> replicate()</a></li>
<li class="chapter" data-level="11.3" data-path="simulating-data.html"><a href="simulating-data.html#sample-revisited"><i class="fa fa-check"></i><b>11.3</b> sample() revisited</a></li>
<li class="chapter" data-level="11.4" data-path="simulating-data.html"><a href="simulating-data.html#generating-fixed-levels--"><i class="fa fa-check"></i><b>11.4</b> generating fixed levels ————————————————-</a></li>
<li class="chapter" data-level="11.5" data-path="simulating-data.html"><a href="simulating-data.html#generating-numerical-sequences"><i class="fa fa-check"></i><b>11.5</b> generating numerical sequences</a></li>
<li class="chapter" data-level="11.6" data-path="simulating-data.html"><a href="simulating-data.html#seq_along-and-seq_len."><i class="fa fa-check"></i><b>11.6</b> seq_along() and seq_len().</a></li>
<li class="chapter" data-level="11.7" data-path="simulating-data.html"><a href="simulating-data.html#generating-random-data-from-a-probability-distribution"><i class="fa fa-check"></i><b>11.7</b> generating random data from a probability distribution</a></li>
<li class="chapter" data-level="11.8" data-path="simulating-data.html"><a href="simulating-data.html#normal-distribution"><i class="fa fa-check"></i><b>11.8</b> Normal distribution:</a></li>
<li class="chapter" data-level="11.9" data-path="simulating-data.html"><a href="simulating-data.html#binomial-distribution"><i class="fa fa-check"></i><b>11.9</b> Binomial distribution:</a></li>
<li class="chapter" data-level="11.10" data-path="simulating-data.html"><a href="simulating-data.html#uniform-distribution"><i class="fa fa-check"></i><b>11.10</b> Uniform distribution</a></li>
<li class="chapter" data-level="11.11" data-path="simulating-data.html"><a href="simulating-data.html#sampling-from-multiple-distributions-building-in-a-difference"><i class="fa fa-check"></i><b>11.11</b> Sampling from multiple distributions (building in a “difference”)</a></li>
<li class="chapter" data-level="11.12" data-path="simulating-data.html"><a href="simulating-data.html#the-good-stuff-building-in-a-difference-based-on-a-categorical-variable"><i class="fa fa-check"></i><b>11.12</b> The good stuff: building in a difference based on a categorical variable</a></li>
<li class="chapter" data-level="11.13" data-path="simulating-data.html"><a href="simulating-data.html#a-demonstration-of-the-central-limit-theorem"><i class="fa fa-check"></i><b>11.13</b> A demonstration of the Central Limit Theorem</a></li>
<li class="chapter" data-level="11.14" data-path="simulating-data.html"><a href="simulating-data.html#overlaying-normal-curve-on-histogram"><i class="fa fa-check"></i><b>11.14</b> Overlaying normal curve on histogram</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>12</b> Functions</a></li>
<li class="chapter" data-level="13" data-path="relativerisk.html"><a href="relativerisk.html"><i class="fa fa-check"></i><b>13</b> Relative versus absolute risk: display</a></li>
<li class="chapter" data-level="14" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html"><i class="fa fa-check"></i><b>14</b> Dimensionality Reduction</a><ul>
<li class="chapter" data-level="14.1" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html#background"><i class="fa fa-check"></i><b>14.1</b> Background</a></li>
<li class="chapter" data-level="14.2" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html#experiment-in-showing-dimensionality-reduction-for-pathologists"><i class="fa fa-check"></i><b>14.2</b> Experiment in showing dimensionality reduction for pathologists</a><ul>
<li class="chapter" data-level="14.2.1" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html#principle-component-analysis"><i class="fa fa-check"></i><b>14.2.1</b> Principle component analysis</a></li>
<li class="chapter" data-level="14.2.2" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html#t-distributed-stochastic-neighbor-embedding"><i class="fa fa-check"></i><b>14.2.2</b> t-distributed stochastic neighbor embedding</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="datashape.html"><a href="datashape.html"><i class="fa fa-check"></i><b>15</b> Shape of Data</a><ul>
<li class="chapter" data-level="15.1" data-path="datashape.html"><a href="datashape.html#making-data-frames"><i class="fa fa-check"></i><b>15.1</b> Making data frames</a></li>
<li class="chapter" data-level="15.2" data-path="datashape.html"><a href="datashape.html#gather-spread-pivoting-in-the-tidyverse"><i class="fa fa-check"></i><b>15.2</b> Gather, spread, pivoting in the tidyverse</a></li>
<li class="chapter" data-level="15.3" data-path="datashape.html"><a href="datashape.html#gathering-steam"><i class="fa fa-check"></i><b>15.3</b> Gathering steam…</a></li>
<li class="chapter" data-level="15.4" data-path="datashape.html"><a href="datashape.html#spread-your-wings"><i class="fa fa-check"></i><b>15.4</b> Spread your wings</a></li>
<li class="chapter" data-level="15.5" data-path="datashape.html"><a href="datashape.html#missing-data-ich-vemisse-dich"><i class="fa fa-check"></i><b>15.5</b> Missing Data: Ich vemisse Dich!</a><ul>
<li class="chapter" data-level="15.5.1" data-path="datashape.html"><a href="datashape.html#you-completeme"><i class="fa fa-check"></i><b>15.5.1</b> You complete(me)</a></li>
<li class="chapter" data-level="15.5.2" data-path="datashape.html"><a href="datashape.html#filling-in-the-gaps"><i class="fa fa-check"></i><b>15.5.2</b> fill(ing) in the gaps</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="datashape.html"><a href="datashape.html#pivoting-to-something-new"><i class="fa fa-check"></i><b>15.6</b> Pivoting to something new</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bill’s Drills Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datashape" class="section level1">
<h1><span class="header-section-number">Chapter 15</span> Shape of Data</h1>
<p>One of my fundamental stumbling blocks is understanding the shape of data, even “rectangular data” of the sort that Hadley Wickham refers to in R4DS.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="datashape.html#cb20-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<div id="making-data-frames" class="section level2">
<h2><span class="header-section-number">15.1</span> Making data frames</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="datashape.html#cb21-1"></a>DF1 &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb21-2"><a href="datashape.html#cb21-2"></a>  <span class="dt">Symbol =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),</span>
<span id="cb21-3"><a href="datashape.html#cb21-3"></a>  <span class="dt">Value =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span></span>
<span id="cb21-4"><a href="datashape.html#cb21-4"></a>)</span>
<span id="cb21-5"><a href="datashape.html#cb21-5"></a>DF1</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Symbol Value
##   &lt;chr&gt;  &lt;int&gt;
## 1 a          1
## 2 b          2
## 3 c          3</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="datashape.html#cb23-1"></a>DF2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb23-2"><a href="datashape.html#cb23-2"></a>  <span class="dt">Symbol =</span> <span class="kw">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>),</span>
<span id="cb23-3"><a href="datashape.html#cb23-3"></a>  <span class="dt">Value =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">6</span></span>
<span id="cb23-4"><a href="datashape.html#cb23-4"></a>)</span>
<span id="cb23-5"><a href="datashape.html#cb23-5"></a>DF2</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Symbol Value
##   &lt;chr&gt;  &lt;int&gt;
## 1 c          4
## 2 d          5
## 3 e          6</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="datashape.html#cb25-1"></a>DFmerge &lt;-<span class="st"> </span><span class="kw">rbind</span>(DF1,DF2)</span>
<span id="cb25-2"><a href="datashape.html#cb25-2"></a>DFmerge</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   Symbol Value
##   &lt;chr&gt;  &lt;int&gt;
## 1 a          1
## 2 b          2
## 3 c          3
## 4 c          4
## 5 d          5
## 6 e          6</code></pre>
</div>
<div id="gather-spread-pivoting-in-the-tidyverse" class="section level2">
<h2><span class="header-section-number">15.2</span> Gather, spread, pivoting in the tidyverse</h2>
<p>The following exercises are based on <strong>R4DS</strong>.</p>
<p>Several simple data tables are available for practice. Check them out:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="datashape.html#cb27-1"></a>table1</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Note that only table 1 is tidy. Tidy rules the day, making cool things possible. For instance:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="datashape.html#cb29-1"></a>table1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-2"><a href="datashape.html#cb29-2"></a><span class="st">  </span><span class="kw">count</span>(year, <span class="dt">wt =</span> cases)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##    year      n
##   &lt;int&gt;  &lt;int&gt;
## 1  1999 250740
## 2  2000 296920</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="datashape.html#cb31-1"></a>table1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-2"><a href="datashape.html#cb31-2"></a><span class="st">  </span><span class="kw">count</span>(year, <span class="dt">wt =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##    year     n
##   &lt;int&gt; &lt;int&gt;
## 1  1999     3
## 2  2000     3</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="datashape.html#cb33-1"></a><span class="co"># BTW, note the difference between the above count and this one:</span></span>
<span id="cb33-2"><a href="datashape.html#cb33-2"></a>table1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-3"><a href="datashape.html#cb33-3"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-4"><a href="datashape.html#cb33-4"></a><span class="st">  </span><span class="kw">count</span>(cases)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   year [2]
##    year  cases     n
##   &lt;int&gt;  &lt;int&gt; &lt;int&gt;
## 1  1999    745     1
## 2  1999  37737     1
## 3  1999 212258     1
## 4  2000   2666     1
## 5  2000  80488     1
## 6  2000 213766     1</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="datashape.html#cb35-1"></a><span class="co"># Or the following group and summarize:</span></span>
<span id="cb35-2"><a href="datashape.html#cb35-2"></a>table1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-3"><a href="datashape.html#cb35-3"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-4"><a href="datashape.html#cb35-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">AggCases =</span> <span class="kw">sum</span>(cases))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 2
##    year AggCases
##   &lt;int&gt;    &lt;int&gt;
## 1  1999   250740
## 2  2000   296920</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="datashape.html#cb38-1"></a><span class="co"># Or the following plot (I couldn&#39;t help but embellish this with a fct_reorder--vital to ggplot/geom_line displays,but a trick that I always forget):</span></span>
<span id="cb38-2"><a href="datashape.html#cb38-2"></a></span>
<span id="cb38-3"><a href="datashape.html#cb38-3"></a>table1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb38-4"><a href="datashape.html#cb38-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">fct_reorder</span>(country, <span class="op">-</span>population)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb38-5"><a href="datashape.html#cb38-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, cases)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-6"><a href="datashape.html#cb38-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country), <span class="dt">colour =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-7"><a href="datashape.html#cb38-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> country))</span></code></pre></div>
<p><img src="test-book_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>An aside on count() and tally(): tally() is a convenient wrapper for summarise that will either call n() or sum(n) depending on whether you’re tallying for the first time, or re-tallying. count() is similar but calls group_by() before and ungroup() after. If the data is already grouped, count() adds an additional group that is removed afterwards.</p>
<p>Tidy data is not space-efficient, though. Note how values are reduplicated. This is not an issue in small datasets, but can be a bummer if datasets get large or human data entry is necessary–manually entering demographics is always error-prone.</p>
<p>Table 2 on the other hand contains 2 sorts of data in the count column–cases and population. Not only is this less efficient than table 1, it is much more verbose.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="datashape.html#cb39-1"></a>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<p>Table 3 contains unnecessary internal structure. I combines two values into one field. Kudos for transparency, but little is actually gained by doing this, and it complicates analyses. Best to break them apart.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="datashape.html#cb41-1"></a>table3</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<p>Tables 4a and 4b break data into separate structures when a single table would suffice. Many database tables will be arranged like this. However, to perform calculations on data from each table, it can be better to weld the tables into a single structure.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="datashape.html#cb43-1"></a>table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="datashape.html#cb45-1"></a>table4b</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country         `1999`     `2000`
## * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan   19987071   20595360
## 2 Brazil       172006362  174504898
## 3 China       1272915272 1280428583</code></pre>
</div>
<div id="gathering-steam" class="section level2">
<h2><span class="header-section-number">15.3</span> Gathering steam…</h2>
<p>Table 4a has a <em>key</em> field–the year–and a <em>value</em> field–cases. To bring the key down into the table, we gather it:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="datashape.html#cb47-1"></a>table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="datashape.html#cb49-1"></a>tidy4a &lt;-<span class="st"> </span>table4a <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-2"><a href="datashape.html#cb49-2"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)</span>
<span id="cb49-3"><a href="datashape.html#cb49-3"></a>tidy4a</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year   cases
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
## 1 Afghanistan 1999     745
## 2 Brazil      1999   37737
## 3 China       1999  212258
## 4 Afghanistan 2000    2666
## 5 Brazil      2000   80488
## 6 China       2000  213766</code></pre>
<p>Note that we replace column names that should be data fields with a key (in this example we call it “year”), and the corresponding data held in table4a with a value (in this example “cases”).</p>
<p>The same thing can be done with 4b, except now the value is population.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="datashape.html#cb51-1"></a>table4b</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country         `1999`     `2000`
## * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan   19987071   20595360
## 2 Brazil       172006362  174504898
## 3 China       1272915272 1280428583</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="datashape.html#cb53-1"></a>tidy4b &lt;-<span class="st"> </span>table4b <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-2"><a href="datashape.html#cb53-2"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;population&quot;</span>)</span>
<span id="cb53-3"><a href="datashape.html#cb53-3"></a>tidy4b</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year  population
##   &lt;chr&gt;       &lt;chr&gt;      &lt;int&gt;
## 1 Afghanistan 1999    19987071
## 2 Brazil      1999   172006362
## 3 China       1999  1272915272
## 4 Afghanistan 2000    20595360
## 5 Brazil      2000   174504898
## 6 China       2000  1280428583</code></pre>
<p>Note that we get new key and value columns and the gathered columns are dropped. This has the effect of gathering them down into more rows.</p>
<p>It should be noted that many examples of gathering are not written in this way. By default, the key and value simply dropped into the correct part of the gather(). Columns that are not part of the gather are then exempted by negation.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="datashape.html#cb55-1"></a>table4b <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb55-2"><a href="datashape.html#cb55-2"></a><span class="st">  </span><span class="kw">gather</span>(year, cases, <span class="op">-</span>country)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year       cases
##   &lt;chr&gt;       &lt;chr&gt;      &lt;int&gt;
## 1 Afghanistan 1999    19987071
## 2 Brazil      1999   172006362
## 3 China       1999  1272915272
## 4 Afghanistan 2000    20595360
## 5 Brazil      2000   174504898
## 6 China       2000  1280428583</code></pre>
<p>David Robinson has even shown examples where he simply uses gather(key, value, -exemptedColumn) (see his YouTube at <a href="https://www.youtube.com/watch?v=KzRP40PzopY" class="uri">https://www.youtube.com/watch?v=KzRP40PzopY</a>).</p>
<p>The two new tidy tables are joined as follows:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="datashape.html#cb57-1"></a><span class="kw">left_join</span>(tidy4a, tidy4b)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;country&quot;, &quot;year&quot;)</code></pre>
<pre><code>## # A tibble: 6 x 4
##   country     year   cases population
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan 1999     745   19987071
## 2 Brazil      1999   37737  172006362
## 3 China       1999  212258 1272915272
## 4 Afghanistan 2000    2666   20595360
## 5 Brazil      2000   80488  174504898
## 6 China       2000  213766 1280428583</code></pre>
<p>David Robinson shows in this bit <a href="https://www.youtube.com/watch?v=KzRP40PzopY" class="uri">https://www.youtube.com/watch?v=KzRP40PzopY</a> (about 8m 30s into the YouTube) that you don’t need to make the key and value explicit, and also that you can exempt some columns from the process.</p>
</div>
<div id="spread-your-wings" class="section level2">
<h2><span class="header-section-number">15.4</span> Spread your wings</h2>
<p>So spread is the opposite of gather. Consider Table 2.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="datashape.html#cb60-1"></a>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<p>Now our task is to spread cases and population from the type column into their own columns. In <code>table2</code> the <code>type</code> column should be distributed into variable with their own columns. Note that this has the effect of <em>spreading</em> table into more columns.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="datashape.html#cb62-1"></a>table2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-2"><a href="datashape.html#cb62-2"></a><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> type, <span class="dt">value =</span> count)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Hadley provides an interesting example that shows how gather and spread are NOT perfect compliments.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="datashape.html#cb64-1"></a>stocks &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb64-2"><a href="datashape.html#cb64-2"></a>  <span class="dt">year   =</span> <span class="kw">c</span>(<span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2016</span>),</span>
<span id="cb64-3"><a href="datashape.html#cb64-3"></a>  <span class="dt">half  =</span> <span class="kw">c</span>(   <span class="dv">1</span>,    <span class="dv">2</span>,     <span class="dv">1</span>,    <span class="dv">2</span>),</span>
<span id="cb64-4"><a href="datashape.html#cb64-4"></a>  <span class="dt">return =</span> <span class="kw">c</span>(<span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>)</span>
<span id="cb64-5"><a href="datashape.html#cb64-5"></a>)</span>
<span id="cb64-6"><a href="datashape.html#cb64-6"></a>stocks</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##    year  half return
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1  2015     1   1.88
## 2  2015     2   0.59
## 3  2016     1   0.92
## 4  2016     2   0.17</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="datashape.html#cb66-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb66-2"><a href="datashape.html#cb66-2"></a><span class="st">  </span><span class="kw">spread</span>(year, return) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb66-3"><a href="datashape.html#cb66-3"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;return&quot;</span>, <span class="st">`</span><span class="dt">2015</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##    half year  return
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1     1 2015    1.88
## 2     2 2015    0.59
## 3     1 2016    0.92
## 4     2 2016    0.17</code></pre>
<p>Note how the correct columns are in place, but the year column is now character data.</p>
</div>
<div id="missing-data-ich-vemisse-dich" class="section level2">
<h2><span class="header-section-number">15.5</span> Missing Data: Ich vemisse Dich!</h2>
<p>Hadley provides a different stock example:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="datashape.html#cb68-1"></a>stocks &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb68-2"><a href="datashape.html#cb68-2"></a>  <span class="dt">year   =</span> <span class="kw">c</span>(<span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2016</span>, <span class="dv">2016</span>),</span>
<span id="cb68-3"><a href="datashape.html#cb68-3"></a>  <span class="dt">qtr    =</span> <span class="kw">c</span>(   <span class="dv">1</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>),</span>
<span id="cb68-4"><a href="datashape.html#cb68-4"></a>  <span class="dt">return =</span> <span class="kw">c</span>(<span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.35</span>,   <span class="ot">NA</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>, <span class="fl">2.66</span>)</span>
<span id="cb68-5"><a href="datashape.html#cb68-5"></a>)</span>
<span id="cb68-6"><a href="datashape.html#cb68-6"></a></span>
<span id="cb68-7"><a href="datashape.html#cb68-7"></a>stocks</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##    year   qtr return
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1  2015     1   1.88
## 2  2015     2   0.59
## 3  2015     3   0.35
## 4  2015     4  NA   
## 5  2016     2   0.92
## 6  2016     3   0.17
## 7  2016     4   2.66</code></pre>
<p>Hadley points out that 2 data points are missing in this data set: one explicit and one implicit.</p>
<blockquote>
<p>One way to think about the difference is with this Zen-like koan: An explicit missing value is the presence of an absence; an implicit missing value is the absence of a presence.</p>
</blockquote>
<p>The implicitly missing value here can be made explicit by <em>spreading</em> the years.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="datashape.html#cb70-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb70-2"><a href="datashape.html#cb70-2"></a><span class="st">  </span><span class="kw">spread</span>(year, return)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     qtr `2015` `2016`
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1   1.88  NA   
## 2     2   0.59   0.92
## 3     3   0.35   0.17
## 4     4  NA      2.66</code></pre>
<p>Note exactly how this works: the rows are now determined by qtr. The 2015 4th quarter value, explicitly NA before, remains NA. Now, however, when 2016 is spread as a variable, the gap in quarter 1 is revealed.</p>
<p>These NA’s can be removed by gathering the data back up using na.rm = TRUE.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="datashape.html#cb72-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb72-2"><a href="datashape.html#cb72-2"></a><span class="st">  </span><span class="kw">spread</span>(year, return) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb72-3"><a href="datashape.html#cb72-3"></a><span class="st">  </span><span class="kw">gather</span>(year, return, <span class="st">`</span><span class="dt">2015</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##     qtr year  return
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1     1 2015    1.88
## 2     2 2015    0.59
## 3     3 2015    0.35
## 4     2 2016    0.92
## 5     3 2016    0.17
## 6     4 2016    2.66</code></pre>
<div id="you-completeme" class="section level3">
<h3><span class="header-section-number">15.5.1</span> You complete(me)</h3>
<p>The complete() function is also an important way to make missing values explicit.</p>
<p>&lt; <em>complete()</em> takes a set of columns, and finds all unique combinations. It then ensures the original dataset contains all those values, filling in explicit NAs where necessary</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="datashape.html#cb74-1"></a>stocks</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##    year   qtr return
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1  2015     1   1.88
## 2  2015     2   0.59
## 3  2015     3   0.35
## 4  2015     4  NA   
## 5  2016     2   0.92
## 6  2016     3   0.17
## 7  2016     4   2.66</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="datashape.html#cb76-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb76-2"><a href="datashape.html#cb76-2"></a><span class="st">  </span><span class="kw">complete</span>(year, qtr)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##    year   qtr return
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1  2015     1   1.88
## 2  2015     2   0.59
## 3  2015     3   0.35
## 4  2015     4  NA   
## 5  2016     1  NA   
## 6  2016     2   0.92
## 7  2016     3   0.17
## 8  2016     4   2.66</code></pre>
</div>
<div id="filling-in-the-gaps" class="section level3">
<h3><span class="header-section-number">15.5.2</span> fill(ing) in the gaps</h3>
<p>While complete() can make explicit the missing values, fill() lets you address a particular type of missing value. Here, the last observation is carried forward. This is very common in data sets.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="datashape.html#cb78-1"></a>treatment &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb78-2"><a href="datashape.html#cb78-2"></a>  <span class="op">~</span><span class="st"> </span>person,           <span class="op">~</span><span class="st"> </span>treatment, <span class="op">~</span>response,</span>
<span id="cb78-3"><a href="datashape.html#cb78-3"></a>  <span class="st">&quot;Derrick Whitmore&quot;</span>, <span class="dv">1</span>,           <span class="dv">7</span>,</span>
<span id="cb78-4"><a href="datashape.html#cb78-4"></a>  <span class="ot">NA</span>,                 <span class="dv">2</span>,           <span class="dv">10</span>,</span>
<span id="cb78-5"><a href="datashape.html#cb78-5"></a>  <span class="ot">NA</span>,                 <span class="dv">3</span>,           <span class="dv">9</span>,</span>
<span id="cb78-6"><a href="datashape.html#cb78-6"></a>  <span class="st">&quot;Katherine Burke&quot;</span>,  <span class="dv">1</span>,           <span class="dv">4</span></span>
<span id="cb78-7"><a href="datashape.html#cb78-7"></a>)</span>
<span id="cb78-8"><a href="datashape.html#cb78-8"></a></span>
<span id="cb78-9"><a href="datashape.html#cb78-9"></a>treatment</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   person           treatment response
##   &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;
## 1 Derrick Whitmore         1        7
## 2 &lt;NA&gt;                     2       10
## 3 &lt;NA&gt;                     3        9
## 4 Katherine Burke          1        4</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="datashape.html#cb80-1"></a>treatment <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb80-2"><a href="datashape.html#cb80-2"></a><span class="st">  </span><span class="kw">fill</span>(person)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   person           treatment response
##   &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;
## 1 Derrick Whitmore         1        7
## 2 Derrick Whitmore         2       10
## 3 Derrick Whitmore         3        9
## 4 Katherine Burke          1        4</code></pre>
</div>
</div>
<div id="pivoting-to-something-new" class="section level2">
<h2><span class="header-section-number">15.6</span> Pivoting to something new</h2>
<p>These are great exercises, but gather() and spread() are being upgraded to pivot_longer() and pivot_wider(). See <a href="https://www.r-bloggers.com/data-pivoting-with-tidyr/" class="uri">https://www.r-bloggers.com/data-pivoting-with-tidyr/</a></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="datashape.html#cb82-1"></a>table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="datashape.html#cb84-1"></a>table4a_long &lt;-<span class="st"> </span>table4a <span class="op">%&gt;%</span></span>
<span id="cb84-2"><a href="datashape.html#cb84-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb84-3"><a href="datashape.html#cb84-3"></a>    <span class="st">`</span><span class="dt">1999</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2000</span><span class="st">`</span>,</span>
<span id="cb84-4"><a href="datashape.html#cb84-4"></a>    <span class="dt">names_to =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb84-5"><a href="datashape.html#cb84-5"></a>    <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb84-6"><a href="datashape.html#cb84-6"></a>  )</span>
<span id="cb84-7"><a href="datashape.html#cb84-7"></a></span>
<span id="cb84-8"><a href="datashape.html#cb84-8"></a>table4a_long</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year   value
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
## 1 Afghanistan 1999     745
## 2 Afghanistan 2000    2666
## 3 Brazil      1999   37737
## 4 Brazil      2000   80488
## 5 China       1999  212258
## 6 China       2000  213766</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="datashape.html#cb86-1"></a>table4b_long &lt;-<span class="st"> </span>table4b <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb86-2"><a href="datashape.html#cb86-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb86-3"><a href="datashape.html#cb86-3"></a>    <span class="st">`</span><span class="dt">1999</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2000</span><span class="st">`</span>,</span>
<span id="cb86-4"><a href="datashape.html#cb86-4"></a>    <span class="dt">names_to =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb86-5"><a href="datashape.html#cb86-5"></a>    <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb86-6"><a href="datashape.html#cb86-6"></a>  )</span>
<span id="cb86-7"><a href="datashape.html#cb86-7"></a></span>
<span id="cb86-8"><a href="datashape.html#cb86-8"></a>table4b_long</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year       value
##   &lt;chr&gt;       &lt;chr&gt;      &lt;int&gt;
## 1 Afghanistan 1999    19987071
## 2 Afghanistan 2000    20595360
## 3 Brazil      1999   172006362
## 4 Brazil      2000   174504898
## 5 China       1999  1272915272
## 6 China       2000  1280428583</code></pre>
<p>This is presumably reversible.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="datashape.html#cb88-1"></a>table4aNew &lt;-<span class="st"> </span>table4a_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb88-2"><a href="datashape.html#cb88-2"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb88-3"><a href="datashape.html#cb88-3"></a>    <span class="dt">names_from =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb88-4"><a href="datashape.html#cb88-4"></a>    <span class="dt">values_from =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb88-5"><a href="datashape.html#cb88-5"></a>  )</span>
<span id="cb88-6"><a href="datashape.html#cb88-6"></a></span>
<span id="cb88-7"><a href="datashape.html#cb88-7"></a>table4aNew</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
##   &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="datashape.html#cb90-1"></a>table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<p>So they are the same.</p>
<p>Table 2 can also be <code>spread()</code>… ahem, <code>pivot_wider()</code>ed. </p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="datashape.html#cb92-1"></a>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="datashape.html#cb94-1"></a>table2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pivot_wider</span>(</span>
<span id="cb94-2"><a href="datashape.html#cb94-2"></a>  <span class="dt">names_from =</span> <span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;type&quot;</span>),</span>
<span id="cb94-3"><a href="datashape.html#cb94-3"></a>  <span class="dt">values_from =</span> <span class="st">&quot;count&quot;</span></span>
<span id="cb94-4"><a href="datashape.html#cb94-4"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   country     `1999_cases` `1999_population` `2000_cases` `2000_population`
##   &lt;chr&gt;              &lt;int&gt;             &lt;int&gt;        &lt;int&gt;             &lt;int&gt;
## 1 Afghanistan          745          19987071         2666          20595360
## 2 Brazil             37737         172006362        80488         174504898
## 3 China             212258        1272915272       213766        1280428583</code></pre>
<p>Note that, names_from can come from multiple columns. When there are multiple names_from or values_from columns, names_sep will be used to join values together to form column names.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dimensionalityreduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/14shapes.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["test-book.pdf", "test-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
