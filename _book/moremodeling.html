<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 18 More modeling | Bill’s Drills Book</title>
  <meta name="description" content="Chapter 18 More modeling | Bill’s Drills Book" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 18 More modeling | Bill’s Drills Book" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="https://github.com/wliammd/billsDrills" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 18 More modeling | Bill’s Drills Book" />
  
  
  

<meta name="author" content="William McDonald" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="modeling.html"/>
<link rel="next" href="github.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Bill's Drills Book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Drills: Part of Every Healthy Intellectual Diet</a></li>
<li class="chapter" data-level="2" data-path="bookdownplan.html"><a href="bookdownplan.html"><i class="fa fa-check"></i><b>2</b> <strong>bookdown</strong> Tips for This Document</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bookdownplan.html"><a href="bookdownplan.html#basic-conventions"><i class="fa fa-check"></i><b>2.1</b> Basic conventions</a></li>
<li class="chapter" data-level="2.2" data-path="bookdownplan.html"><a href="bookdownplan.html#inserting-pictures"><i class="fa fa-check"></i><b>2.2</b> Inserting pictures</a></li>
<li class="chapter" data-level="2.3" data-path="bookdownplan.html"><a href="bookdownplan.html#referencing-other-parts-of-the-document"><i class="fa fa-check"></i><b>2.3</b> Referencing other parts of the document</a></li>
<li class="chapter" data-level="2.4" data-path="bookdownplan.html"><a href="bookdownplan.html#referencing-citations"><i class="fa fa-check"></i><b>2.4</b> Referencing citations:</a></li>
<li class="chapter" data-level="2.5" data-path="bookdownplan.html"><a href="bookdownplan.html#figures."><i class="fa fa-check"></i><b>2.5</b> Figures.</a></li>
<li class="chapter" data-level="2.6" data-path="bookdownplan.html"><a href="bookdownplan.html#working-with-github"><i class="fa fa-check"></i><b>2.6</b> Working with Github</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datashape.html"><a href="datashape.html"><i class="fa fa-check"></i><b>3</b> Shape of Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="datashape.html"><a href="datashape.html#making-data-frames"><i class="fa fa-check"></i><b>3.1</b> Making data frames</a></li>
<li class="chapter" data-level="3.2" data-path="datashape.html"><a href="datashape.html#gather-spread-pivoting-in-the-tidyverse"><i class="fa fa-check"></i><b>3.2</b> Gather, spread, pivoting in the tidyverse</a></li>
<li class="chapter" data-level="3.3" data-path="datashape.html"><a href="datashape.html#gathering-steam"><i class="fa fa-check"></i><b>3.3</b> Gathering steam…</a></li>
<li class="chapter" data-level="3.4" data-path="datashape.html"><a href="datashape.html#spread-your-wings"><i class="fa fa-check"></i><b>3.4</b> Spread your wings</a></li>
<li class="chapter" data-level="3.5" data-path="datashape.html"><a href="datashape.html#missing-data-ich-vemisse-dich"><i class="fa fa-check"></i><b>3.5</b> Missing Data: Ich vemisse Dich!</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="datashape.html"><a href="datashape.html#you-completeme"><i class="fa fa-check"></i><b>3.5.1</b> You complete(me)</a></li>
<li class="chapter" data-level="3.5.2" data-path="datashape.html"><a href="datashape.html#filling-in-the-gaps"><i class="fa fa-check"></i><b>3.5.2</b> fill(ing) in the gaps</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="datashape.html"><a href="datashape.html#pivoting-to-something-new"><i class="fa fa-check"></i><b>3.6</b> Pivoting to something new</a></li>
<li class="chapter" data-level="3.7" data-path="datashape.html"><a href="datashape.html#larger-structures"><i class="fa fa-check"></i><b>3.7</b> Larger structures</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="changenames.html"><a href="changenames.html"><i class="fa fa-check"></i><b>4</b> By Any Other Name</a>
<ul>
<li class="chapter" data-level="4.1" data-path="changenames.html"><a href="changenames.html#a-financial-example"><i class="fa fa-check"></i><b>4.1</b> A financial example</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="factorpractice.html"><a href="factorpractice.html"><i class="fa fa-check"></i><b>5</b> Factor Practice</a>
<ul>
<li class="chapter" data-level="5.1" data-path="factorpractice.html"><a href="factorpractice.html#the-basic-structure"><i class="fa fa-check"></i><b>5.1</b> The basic structure</a></li>
<li class="chapter" data-level="5.2" data-path="factorpractice.html"><a href="factorpractice.html#not-all-nominal-data-is-a-factor"><i class="fa fa-check"></i><b>5.2</b> Not all nominal data is a factor</a></li>
<li class="chapter" data-level="5.3" data-path="factorpractice.html"><a href="factorpractice.html#making-variables-into-factors"><i class="fa fa-check"></i><b>5.3</b> Making variables into factors</a></li>
<li class="chapter" data-level="5.4" data-path="factorpractice.html"><a href="factorpractice.html#inspecting-factors"><i class="fa fa-check"></i><b>5.4</b> Inspecting factors</a></li>
<li class="chapter" data-level="5.5" data-path="factorpractice.html"><a href="factorpractice.html#fct_lump"><i class="fa fa-check"></i><b>5.5</b> fct_lump()</a></li>
<li class="chapter" data-level="5.6" data-path="factorpractice.html"><a href="factorpractice.html#fct_infreq-and-fct_rev"><i class="fa fa-check"></i><b>5.6</b> fct_infreq() and fct_rev()</a></li>
<li class="chapter" data-level="5.7" data-path="factorpractice.html"><a href="factorpractice.html#additional-practice"><i class="fa fa-check"></i><b>5.7</b> Additional practice</a></li>
<li class="chapter" data-level="5.8" data-path="factorpractice.html"><a href="factorpractice.html#reordering-factors"><i class="fa fa-check"></i><b>5.8</b> Reordering Factors</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="factorpractice.html"><a href="factorpractice.html#fct_reorder2-another-way-to-improve-legibility"><i class="fa fa-check"></i><b>5.8.1</b> fct_reorder2(): another way to improve legibility</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="subset.html"><a href="subset.html"><i class="fa fa-check"></i><b>6</b> Subsetting</a>
<ul>
<li class="chapter" data-level="6.1" data-path="subset.html"><a href="subset.html#subsetting-using-brackets"><i class="fa fa-check"></i><b>6.1</b> Subsetting using brackets</a></li>
<li class="chapter" data-level="6.2" data-path="subset.html"><a href="subset.html#subset-using-brackets-by-omitting-the-rows-and-columns-we-dont-want"><i class="fa fa-check"></i><b>6.2</b> Subset using brackets by omitting the rows and columns we don’t want</a></li>
<li class="chapter" data-level="6.3" data-path="subset.html"><a href="subset.html#subset-using-brackets-in-combination-with-the-which-function-and-the-in-operator"><i class="fa fa-check"></i><b>6.3</b> Subset using brackets in combination with the which() function and the %in% operator</a></li>
<li class="chapter" data-level="6.4" data-path="subset.html"><a href="subset.html#subset-using-the-subset-function"><i class="fa fa-check"></i><b>6.4</b> Subset using the subset() function</a></li>
<li class="chapter" data-level="6.5" data-path="subset.html"><a href="subset.html#subset-using-dyplyrs-filter-and-select"><i class="fa fa-check"></i><b>6.5</b> Subset using dyplyr’s filter() and select()</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dataexploration.html"><a href="dataexploration.html"><i class="fa fa-check"></i><b>7</b> Data Exploration</a>
<ul>
<li class="chapter" data-level="7.1" data-path="dataexploration.html"><a href="dataexploration.html#counting-things.-the-naming-of-parts."><i class="fa fa-check"></i><b>7.1</b> Counting things. The naming of parts.</a></li>
<li class="chapter" data-level="7.2" data-path="dataexploration.html"><a href="dataexploration.html#fct_infreq"><i class="fa fa-check"></i><b>7.2</b> fct_infreq</a></li>
<li class="chapter" data-level="7.3" data-path="dataexploration.html"><a href="dataexploration.html#weight-weight-dont-tell-me"><i class="fa fa-check"></i><b>7.3</b> Weight weight, don’t tell me!</a></li>
<li class="chapter" data-level="7.4" data-path="dataexploration.html"><a href="dataexploration.html#summarize-is-another-very-useful-function"><i class="fa fa-check"></i><b>7.4</b> Summarize is another very useful function:</a></li>
<li class="chapter" data-level="7.5" data-path="dataexploration.html"><a href="dataexploration.html#graphical-displays"><i class="fa fa-check"></i><b>7.5</b> Graphical displays</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="dataexploration.html"><a href="dataexploration.html#joyplots"><i class="fa fa-check"></i><b>7.5.1</b> Joyplots</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="dataexploration.html"><a href="dataexploration.html#relative-versus-absolute-risk"><i class="fa fa-check"></i><b>7.6</b> Relative versus absolute risk</a></li>
<li class="chapter" data-level="7.7" data-path="dataexploration.html"><a href="dataexploration.html#removing-duplicates"><i class="fa fa-check"></i><b>7.7</b> Removing duplicates</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sampling.html"><a href="sampling.html"><i class="fa fa-check"></i><b>8</b> Sampling</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sampling.html"><a href="sampling.html#think-about-throwing-a-bunch-of-dice."><i class="fa fa-check"></i><b>8.1</b> Think about throwing a bunch of dice.</a></li>
<li class="chapter" data-level="8.2" data-path="sampling.html"><a href="sampling.html#a-keen-way-to-divide-up-a-dataset-into-testing-and-training-components."><i class="fa fa-check"></i><b>8.2</b> A keen way to divide up a dataset into testing and training components.</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="simulating.html"><a href="simulating.html"><i class="fa fa-check"></i><b>9</b> Simulating data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="simulating.html"><a href="simulating.html#sample"><i class="fa fa-check"></i><b>9.1</b> Sample()</a></li>
<li class="chapter" data-level="9.2" data-path="simulating.html"><a href="simulating.html#replicate"><i class="fa fa-check"></i><b>9.2</b> replicate()</a></li>
<li class="chapter" data-level="9.3" data-path="simulating.html"><a href="simulating.html#sample-revisited"><i class="fa fa-check"></i><b>9.3</b> sample() revisited</a></li>
<li class="chapter" data-level="9.4" data-path="simulating.html"><a href="simulating.html#generating-fixed-levels--"><i class="fa fa-check"></i><b>9.4</b> generating fixed levels ————————————————-</a></li>
<li class="chapter" data-level="9.5" data-path="simulating.html"><a href="simulating.html#generating-numerical-sequences"><i class="fa fa-check"></i><b>9.5</b> generating numerical sequences</a></li>
<li class="chapter" data-level="9.6" data-path="simulating.html"><a href="simulating.html#seq_along-and-seq_len."><i class="fa fa-check"></i><b>9.6</b> seq_along() and seq_len().</a></li>
<li class="chapter" data-level="9.7" data-path="simulating.html"><a href="simulating.html#generating-random-data-from-a-probability-distribution"><i class="fa fa-check"></i><b>9.7</b> generating random data from a probability distribution</a></li>
<li class="chapter" data-level="9.8" data-path="simulating.html"><a href="simulating.html#normal-distribution"><i class="fa fa-check"></i><b>9.8</b> Normal distribution:</a></li>
<li class="chapter" data-level="9.9" data-path="simulating.html"><a href="simulating.html#binomial-distribution"><i class="fa fa-check"></i><b>9.9</b> Binomial distribution:</a></li>
<li class="chapter" data-level="9.10" data-path="simulating.html"><a href="simulating.html#uniform-distribution"><i class="fa fa-check"></i><b>9.10</b> Uniform distribution</a></li>
<li class="chapter" data-level="9.11" data-path="simulating.html"><a href="simulating.html#sampling-from-multiple-distributions-building-in-a-difference"><i class="fa fa-check"></i><b>9.11</b> Sampling from multiple distributions (building in a “difference”)</a></li>
<li class="chapter" data-level="9.12" data-path="simulating.html"><a href="simulating.html#the-good-stuff-building-in-a-difference-based-on-a-categorical-variable"><i class="fa fa-check"></i><b>9.12</b> The good stuff: building in a difference based on a categorical variable</a></li>
<li class="chapter" data-level="9.13" data-path="simulating.html"><a href="simulating.html#a-demonstration-of-the-central-limit-theorem"><i class="fa fa-check"></i><b>9.13</b> A demonstration of the Central Limit Theorem</a></li>
<li class="chapter" data-level="9.14" data-path="simulating.html"><a href="simulating.html#overlaying-normal-curve-on-histogram"><i class="fa fa-check"></i><b>9.14</b> Overlaying normal curve on histogram</a></li>
<li class="chapter" data-level="9.15" data-path="simulating.html"><a href="simulating.html#crossing-trial"><i class="fa fa-check"></i><b>9.15</b> Crossing trial</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>10</b> Functions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="functions.html"><a href="functions.html#a-little-dungeons-dragons-tm-to-spice-it-up"><i class="fa fa-check"></i><b>10.1</b> A little Dungeons &amp; Dragons (tm) to spice it up</a></li>
<li class="chapter" data-level="10.2" data-path="functions.html"><a href="functions.html#geometric-and-harmonic-means"><i class="fa fa-check"></i><b>10.2</b> Geometric and harmonic means</a></li>
<li class="chapter" data-level="10.3" data-path="functions.html"><a href="functions.html#for-loop"><i class="fa fa-check"></i><b>10.3</b> for loop</a></li>
<li class="chapter" data-level="10.4" data-path="functions.html"><a href="functions.html#case_when"><i class="fa fa-check"></i><b>10.4</b> case_when()</a></li>
<li class="chapter" data-level="10.5" data-path="functions.html"><a href="functions.html#compare-this-with-if_else"><i class="fa fa-check"></i><b>10.5</b> Compare this with if_else()</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="correlation.html"><a href="correlation.html"><i class="fa fa-check"></i><b>11</b> Correlation Plots</a></li>
<li class="chapter" data-level="12" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html"><i class="fa fa-check"></i><b>12</b> Dimensionality Reduction</a>
<ul>
<li class="chapter" data-level="12.1" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html#background"><i class="fa fa-check"></i><b>12.1</b> Background</a></li>
<li class="chapter" data-level="12.2" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html#experiment-in-showing-dimensionality-reduction-for-pathologists"><i class="fa fa-check"></i><b>12.2</b> Experiment in showing dimensionality reduction for pathologists</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html#principle-component-analysis"><i class="fa fa-check"></i><b>12.2.1</b> Principle component analysis</a></li>
<li class="chapter" data-level="12.2.2" data-path="dimensionalityreduction.html"><a href="dimensionalityreduction.html#t-distributed-stochastic-neighbor-embedding"><i class="fa fa-check"></i><b>12.2.2</b> t-distributed stochastic neighbor embedding</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>13</b> Clustering</a></li>
<li class="chapter" data-level="14" data-path="regex.html"><a href="regex.html"><i class="fa fa-check"></i><b>14</b> Regular expressions</a>
<ul>
<li class="chapter" data-level="14.1" data-path="regex.html"><a href="regex.html#seeking-patterns"><i class="fa fa-check"></i><b>14.1</b> Seeking patterns</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="census.html"><a href="census.html"><i class="fa fa-check"></i><b>15</b> US_Census_Data_Kyle_Walker_Presentation_YouTube</a>
<ul>
<li class="chapter" data-level="15.1" data-path="census.html"><a href="census.html#variables"><i class="fa fa-check"></i><b>15.1</b> Variables</a></li>
<li class="chapter" data-level="15.2" data-path="census.html"><a href="census.html#part-2-wrangling-census-data-with-tidyverse-tools"><i class="fa fa-check"></i><b>15.2</b> Part 2: Wrangling Census Data with <strong>tidyverse</strong> Tools</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="census.html"><a href="census.html#normalizing-the-data-with-mutate."><i class="fa fa-check"></i><b>15.2.1</b> Normalizing the data with <code>mutate()</code>.</a></li>
<li class="chapter" data-level="15.2.2" data-path="census.html"><a href="census.html#group_by-and-summarize-in-census-analysis"><i class="fa fa-check"></i><b>15.2.2</b> <code>group_by()</code> and <code>summarize()</code> in census analysis</a></li>
<li class="chapter" data-level="15.2.3" data-path="census.html"><a href="census.html#margin-of-error-considerations"><i class="fa fa-check"></i><b>15.2.3</b> Margin of error considerations</a></li>
<li class="chapter" data-level="15.2.4" data-path="census.html"><a href="census.html#visualizing-margins-of-error"><i class="fa fa-check"></i><b>15.2.4</b> Visualizing margins of error</a></li>
<li class="chapter" data-level="15.2.5" data-path="census.html"><a href="census.html#get_estimates-and-how-to-use-them"><i class="fa fa-check"></i><b>15.2.5</b> <code>get_estimates()</code> and how to use them</a></li>
<li class="chapter" data-level="15.2.6" data-path="census.html"><a href="census.html#ggbeeswarm-automates-some-jitter-considerations"><i class="fa fa-check"></i><b>15.2.6</b> <code>ggbeeswarm()</code> automates some jitter considerations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="knncv.html"><a href="knncv.html"><i class="fa fa-check"></i><b>16</b> <strong>K Nearest Neighbors Revisited: Cross Validation Added</strong> Tips for This Document</a></li>
<li class="chapter" data-level="17" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>17</b> Modeling</a>
<ul>
<li class="chapter" data-level="17.1" data-path="modeling.html"><a href="modeling.html#resources"><i class="fa fa-check"></i><b>17.1</b> Resources:</a></li>
<li class="chapter" data-level="17.2" data-path="modeling.html"><a href="modeling.html#classification-what-im-really-interested-in"><i class="fa fa-check"></i><b>17.2</b> Classification: what I’m really interested in</a></li>
<li class="chapter" data-level="17.3" data-path="modeling.html"><a href="modeling.html#class-imbalance-a-critical-issue-in-pituitary-adenoma-classification"><i class="fa fa-check"></i><b>17.3</b> Class imbalance: a critical issue in pituitary adenoma classification</a></li>
<li class="chapter" data-level="17.4" data-path="modeling.html"><a href="modeling.html#modeling-notes"><i class="fa fa-check"></i><b>17.4</b> Modeling notes</a></li>
<li class="chapter" data-level="17.5" data-path="modeling.html"><a href="modeling.html#out-of-sample-error-example"><i class="fa fa-check"></i><b>17.5</b> Out of sample error example</a></li>
<li class="chapter" data-level="17.6" data-path="modeling.html"><a href="modeling.html#a-regression-example-from-the-course-this-time-using-caret"><i class="fa fa-check"></i><b>17.6</b> A regression example from the course, this time using <strong>caret</strong></a></li>
<li class="chapter" data-level="17.7" data-path="modeling.html"><a href="modeling.html#classification"><i class="fa fa-check"></i><b>17.7</b> Classification</a>
<ul>
<li class="chapter" data-level="17.7.1" data-path="modeling.html"><a href="modeling.html#an-rpart-classification-example."><i class="fa fa-check"></i><b>17.7.1</b> An <strong>rpart</strong> classification example.</a></li>
</ul></li>
<li class="chapter" data-level="17.8" data-path="modeling.html"><a href="modeling.html#from-the-datacamp-course"><i class="fa fa-check"></i><b>17.8</b> From the DataCamp course</a></li>
<li class="chapter" data-level="17.9" data-path="modeling.html"><a href="modeling.html#random-forest-with-caret"><i class="fa fa-check"></i><b>17.9</b> Random forest with <strong>caret</strong></a></li>
<li class="chapter" data-level="17.10" data-path="modeling.html"><a href="modeling.html#random-forest-model-and-tunegrid"><i class="fa fa-check"></i><b>17.10</b> Random forest model and <code>tuneGrid()</code></a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="moremodeling.html"><a href="moremodeling.html"><i class="fa fa-check"></i><b>18</b> More modeling</a>
<ul>
<li class="chapter" data-level="18.1" data-path="moremodeling.html"><a href="moremodeling.html#glmnet-models"><i class="fa fa-check"></i><b>18.1</b> <code>glmnet</code> models</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="moremodeling.html"><a href="moremodeling.html#parameters-for-tuning-glmnet-models"><i class="fa fa-check"></i><b>18.1.1</b> Parameters for tuning <code>glmnet</code> models</a></li>
<li class="chapter" data-level="18.1.2" data-path="moremodeling.html"><a href="moremodeling.html#an-iris-example-of-glmnet"><i class="fa fa-check"></i><b>18.1.2</b> An iris example of <code>glmnet</code></a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="moremodeling.html"><a href="moremodeling.html#imputation-discussion"><i class="fa fa-check"></i><b>18.2</b> Imputation discussion</a></li>
<li class="chapter" data-level="18.3" data-path="moremodeling.html"><a href="moremodeling.html#multiple-preprocessing-methods"><i class="fa fa-check"></i><b>18.3</b> Multiple preprocessing methods</a></li>
<li class="chapter" data-level="18.4" data-path="moremodeling.html"><a href="moremodeling.html#handling-low-information-predictors"><i class="fa fa-check"></i><b>18.4</b> Handling low-information predictors</a></li>
<li class="chapter" data-level="18.5" data-path="moremodeling.html"><a href="moremodeling.html#max-kuhn-on-reusing-a-traincontrol"><i class="fa fa-check"></i><b>18.5</b> Max Kuhn on reusing a trainControl</a></li>
<li class="chapter" data-level="18.6" data-path="moremodeling.html"><a href="moremodeling.html#comparing-models"><i class="fa fa-check"></i><b>18.6</b> Comparing models</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>19</b> Working with GitHub</a>
<ul>
<li class="chapter" data-level="19.1" data-path="github.html"><a href="github.html#basic-idea"><i class="fa fa-check"></i><b>19.1</b> Basic idea</a></li>
<li class="chapter" data-level="19.2" data-path="github.html"><a href="github.html#a-couple-invaluable-websites"><i class="fa fa-check"></i><b>19.2</b> A couple invaluable websites</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="explainingmachinelearning.html"><a href="explainingmachinelearning.html"><i class="fa fa-check"></i><b>20</b> What is machine learning?</a>
<ul>
<li class="chapter" data-level="20.1" data-path="explainingmachinelearning.html"><a href="explainingmachinelearning.html#machine-learning-for-mds"><i class="fa fa-check"></i><b>20.1</b> Machine learning for MD’s</a></li>
<li class="chapter" data-level="20.2" data-path="explainingmachinelearning.html"><a href="explainingmachinelearning.html#supervised-versus-unsuperised-learning"><i class="fa fa-check"></i><b>20.2</b> Supervised versus unsuperised learning</a></li>
<li class="chapter" data-level="20.3" data-path="explainingmachinelearning.html"><a href="explainingmachinelearning.html#classification-versus-regression"><i class="fa fa-check"></i><b>20.3</b> Classification versus regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bill’s Drills Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="moremodeling" class="section level1" number="18">
<h1><span class="header-section-number">Chapter 18</span> More modeling</h1>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="moremodeling.html#cb746-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb746-2"><a href="moremodeling.html#cb746-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code></pre></div>
<div id="glmnet-models" class="section level2" number="18.1">
<h2><span class="header-section-number">18.1</span> <code>glmnet</code> models</h2>
<p><code>glmnet</code> is an extension of glm models with built-in variable selection, which could be really nice for pituitary adenoma classification purposes.</p>
<p><code>glmnet</code> helps deal with colinearity (correlation between predictors in a model) and small samples, both of which are relevant to my pituitary adenoma data.</p>
<p><code>glmnet</code> relies on two forms of regression:</p>
<ul>
<li>Lasso regression, which penalizes the number of nonzero coefficients</li>
<li>Ridge regression, which penalizes the absolute magnitude of the coefficients</li>
<li>Both sorts of regression can be combined</li>
</ul>
<p><code>glmnet</code> attempst to find a simple model with few nonzero coefficients or small absolute magnitude of coefficients.</p>
<p><code>glmnet</code> pairs well with random forest models, since it often yields different results.</p>
<div id="parameters-for-tuning-glmnet-models" class="section level3" number="18.1.1">
<h3><span class="header-section-number">18.1.1</span> Parameters for tuning <code>glmnet</code> models</h3>
<ul>
<li><code>alpha(0,1)</code>: pure ridge at zero, pure lasso at one</li>
<li><code>lambda(0,infinity)</code>: size of the penalty</li>
</ul>
<p>For a single value of alpha, <code>glmnet</code> fits all values of lambda simultaneously. This is “many models for the price of one.” This is known as the “submodel trick.”</p>
<p>Zach Mayer uses a dataset that I can’t seem to locate, so I’ll switch to the code used by Stefania Ashby, which uses iris: <a href="https://neurospection.netlify.app/post/machine-learning-basics-with-caret/#a-classification-example" class="uri">https://neurospection.netlify.app/post/machine-learning-basics-with-caret/#a-classification-example</a></p>
</div>
<div id="an-iris-example-of-glmnet" class="section level3" number="18.1.2">
<h3><span class="header-section-number">18.1.2</span> An iris example of <code>glmnet</code></h3>
<p>Ashby terms this use of <code>glmnet</code> as an <strong>elastic net</strong>. In keeping with her practice, which splits the dataset in order to have a test group on which to estimate the accuracy of the model, we’ll start with that (comments are Ashby’s):</p>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb747-1"><a href="moremodeling.html#cb747-1" aria-hidden="true" tabindex="-1"></a>iris_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(iris)</span>
<span id="cb747-2"><a href="moremodeling.html#cb747-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">28</span>) </span>
<span id="cb747-3"><a href="moremodeling.html#cb747-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-4"><a href="moremodeling.html#cb747-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the original dataset into a training set and a testing set</span></span>
<span id="cb747-5"><a href="moremodeling.html#cb747-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We are using species to partition so that we don&#39;t end up with an uneven amount of one species in either training or testing sets.</span></span>
<span id="cb747-6"><a href="moremodeling.html#cb747-6" aria-hidden="true" tabindex="-1"></a>partition_data <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(iris_data<span class="sc">$</span>Species, <span class="at">times =</span> <span class="dv">1</span>, <span class="at">p =</span> .<span class="dv">7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb747-7"><a href="moremodeling.html#cb747-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-8"><a href="moremodeling.html#cb747-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign sets</span></span>
<span id="cb747-9"><a href="moremodeling.html#cb747-9" aria-hidden="true" tabindex="-1"></a>training.set <span class="ot">&lt;-</span> iris_data[partition_data, ] <span class="co"># Training set</span></span>
<span id="cb747-10"><a href="moremodeling.html#cb747-10" aria-hidden="true" tabindex="-1"></a>testing.set <span class="ot">&lt;-</span> iris_data[<span class="sc">-</span>partition_data, ] <span class="co"># Testing set</span></span>
<span id="cb747-11"><a href="moremodeling.html#cb747-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb747-12"><a href="moremodeling.html#cb747-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity Check: Is data partitioned appropriately, do we have equal numbers of observations for our outcome variable?</span></span>
<span id="cb747-13"><a href="moremodeling.html#cb747-13" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(training.set)</span></code></pre></div>
<pre><code>## [1] 105</code></pre>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="moremodeling.html#cb749-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(training.set<span class="sc">$</span>Species)</span></code></pre></div>
<pre><code>##     setosa versicolor  virginica 
##         35         35         35</code></pre>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="moremodeling.html#cb751-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(testing.set)</span></code></pre></div>
<pre><code>## [1] 45</code></pre>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb753-1"><a href="moremodeling.html#cb753-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(testing.set<span class="sc">$</span>Species)</span></code></pre></div>
<pre><code>##     setosa versicolor  virginica 
##         15         15         15</code></pre>
<p>Now to build Ashby’s model:</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="moremodeling.html#cb755-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the cross-validation method(s)</span></span>
<span id="cb755-2"><a href="moremodeling.html#cb755-2" aria-hidden="true" tabindex="-1"></a>train.control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="co"># k-folds CV with k=10</span></span>
<span id="cb755-3"><a href="moremodeling.html#cb755-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb755-4"><a href="moremodeling.html#cb755-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb755-5"><a href="moremodeling.html#cb755-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">summaryFunction =</span> multiClassSummary)<span class="co"># save predictions for ROC</span></span>
<span id="cb755-6"><a href="moremodeling.html#cb755-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb755-7"><a href="moremodeling.html#cb755-7" aria-hidden="true" tabindex="-1"></a>train.control2 <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;LOOCV&quot;</span>,</span>
<span id="cb755-8"><a href="moremodeling.html#cb755-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb755-9"><a href="moremodeling.html#cb755-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb755-10"><a href="moremodeling.html#cb755-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">summaryFunction =</span> multiClassSummary) <span class="co"># leave-one-out CV, and save predictions for ROC </span></span>
<span id="cb755-11"><a href="moremodeling.html#cb755-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb755-12"><a href="moremodeling.html#cb755-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Model Tuning for Elastic Net</span></span>
<span id="cb755-13"><a href="moremodeling.html#cb755-13" aria-hidden="true" tabindex="-1"></a>glmnet.info <span class="ot">&lt;-</span> <span class="fu">getModelInfo</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb755-14"><a href="moremodeling.html#cb755-14" aria-hidden="true" tabindex="-1"></a>glmnet.info<span class="sc">$</span>glmnet<span class="sc">$</span>parameters</span></code></pre></div>
<pre><code>##   parameter   class                    label
## 1     alpha numeric        Mixing Percentage
## 2    lambda numeric Regularization Parameter</code></pre>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="moremodeling.html#cb757-1" aria-hidden="true" tabindex="-1"></a>tune.grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb757-2"><a href="moremodeling.html#cb757-2" aria-hidden="true" tabindex="-1"></a><span class="at">lambda =</span> <span class="fu">seq</span>(<span class="fl">0.0001</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">100</span>))</span>
<span id="cb757-3"><a href="moremodeling.html#cb757-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb757-4"><a href="moremodeling.html#cb757-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the train function to perform model training</span></span>
<span id="cb757-5"><a href="moremodeling.html#cb757-5" aria-hidden="true" tabindex="-1"></a>glmnet.model <span class="ot">&lt;-</span> <span class="fu">train</span>(Species <span class="sc">~</span>. , </span>
<span id="cb757-6"><a href="moremodeling.html#cb757-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> training.set, </span>
<span id="cb757-7"><a href="moremodeling.html#cb757-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">&quot;glmnet&quot;</span>,</span>
<span id="cb757-8"><a href="moremodeling.html#cb757-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trControl =</span> train.control2, <span class="co"># change this to train.control to try k-fold CV</span></span>
<span id="cb757-9"><a href="moremodeling.html#cb757-9" aria-hidden="true" tabindex="-1"></a>                      <span class="co">#tuneGrid = tune.grid,</span></span>
<span id="cb757-10"><a href="moremodeling.html#cb757-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">preProc =</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>)) </span>
<span id="cb757-11"><a href="moremodeling.html#cb757-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb757-12"><a href="moremodeling.html#cb757-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the results from model training and ROC Curves</span></span>
<span id="cb757-13"><a href="moremodeling.html#cb757-13" aria-hidden="true" tabindex="-1"></a>glmnet.model</span></code></pre></div>
<pre><code>## glmnet 
## 
## 105 samples
##   4 predictor
##   3 classes: &#39;setosa&#39;, &#39;versicolor&#39;, &#39;virginica&#39; 
## 
## Pre-processing: centered (4) 
## Resampling: Leave-One-Out Cross-Validation 
## Summary of sample sizes: 104, 104, 104, 104, 104, 104, ... 
## Resampling results across tuning parameters:
## 
##   alpha  lambda        logLoss     AUC        prAUC      Accuracy   Kappa    
##   0.10   0.0008702402  0.08736163  0.9971429  0.9660011  0.9619048  0.9428571
##   0.10   0.0087024017  0.16409724  0.9959184  0.9637131  0.9523810  0.9285714
##   0.10   0.0870240166  0.37866105  0.9752381  0.9178787  0.8952381  0.8428571
##   0.55   0.0008702402  0.08010236  0.9971429  0.9660011  0.9619048  0.9428571
##   0.55   0.0087024017  0.14944538  0.9961905  0.9641325  0.9523810  0.9285714
##   0.55   0.0870240166  0.40645575  0.9778231  0.9189341  0.9142857  0.8714286
##   1.00   0.0008702402  0.07535390  0.9975510  0.9667069  0.9619048  0.9428571
##   1.00   0.0087024017  0.12708308  0.9953741  0.9626165  0.9523810  0.9285714
##   1.00   0.0870240166  0.41964944  0.9790476  0.9140139  0.9142857  0.8714286
##   Mean_F1    Mean_Sensitivity  Mean_Specificity  Mean_Pos_Pred_Value
##   0.9618736  0.9619048         0.9809524         0.9628720          
##   0.9523712  0.9523810         0.9761905         0.9526144          
##   0.8957327  0.8952381         0.9476190         0.8969263          
##   0.9618736  0.9619048         0.9809524         0.9628720          
##   0.9523712  0.9523810         0.9761905         0.9526144          
##   0.9141280  0.9142857         0.9571429         0.9161184          
##   0.9618736  0.9619048         0.9809524         0.9628720          
##   0.9523712  0.9523810         0.9761905         0.9526144          
##   0.9142682  0.9142857         0.9571429         0.9144880          
##   Mean_Neg_Pred_Value  Mean_Precision  Mean_Recall  Mean_Detection_Rate
##   0.9812092            0.9628720       0.9619048    0.3206349          
##   0.9762537            0.9526144       0.9523810    0.3174603          
##   0.9475283            0.8969263       0.8952381    0.2984127          
##   0.9812092            0.9628720       0.9619048    0.3206349          
##   0.9762537            0.9526144       0.9523810    0.3174603          
##   0.9576774            0.9161184       0.9142857    0.3047619          
##   0.9812092            0.9628720       0.9619048    0.3206349          
##   0.9762537            0.9526144       0.9523810    0.3174603          
##   0.9572022            0.9144880       0.9142857    0.3047619          
##   Mean_Balanced_Accuracy
##   0.9714286             
##   0.9642857             
##   0.9214286             
##   0.9714286             
##   0.9642857             
##   0.9357143             
##   0.9714286             
##   0.9642857             
##   0.9357143             
## 
## Accuracy was used to select the optimal model using the largest value.
## The final values used for the model were alpha = 0.1 and lambda = 0.0008702402.</code></pre>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="moremodeling.html#cb759-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the predictive ability of the model in the testing set</span></span>
<span id="cb759-2"><a href="moremodeling.html#cb759-2" aria-hidden="true" tabindex="-1"></a>glmnet.predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(glmnet.model, testing.set) <span class="co"># Predict values in the testing set</span></span>
<span id="cb759-3"><a href="moremodeling.html#cb759-3" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(glmnet.predict, testing.set<span class="sc">$</span>Species) <span class="co"># the accuracy of the model</span></span></code></pre></div>
<pre><code>##  Accuracy     Kappa 
## 0.9777778 0.9666667</code></pre>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="moremodeling.html#cb761-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(glmnet.predict, testing.set<span class="sc">$</span>Species) <span class="co"># Lets see the breakdown of how well our model worked</span></span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##             Reference
## Prediction   setosa versicolor virginica
##   setosa         15          0         0
##   versicolor      0         14         0
##   virginica       0          1        15
## 
## Overall Statistics
##                                           
##                Accuracy : 0.9778          
##                  95% CI : (0.8823, 0.9994)
##     No Information Rate : 0.3333          
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.9667          
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: setosa Class: versicolor Class: virginica
## Sensitivity                 1.0000            0.9333           1.0000
## Specificity                 1.0000            1.0000           0.9667
## Pos Pred Value              1.0000            1.0000           0.9375
## Neg Pred Value              1.0000            0.9677           1.0000
## Prevalence                  0.3333            0.3333           0.3333
## Detection Rate              0.3333            0.3111           0.3333
## Detection Prevalence        0.3333            0.3111           0.3556
## Balanced Accuracy           1.0000            0.9667           0.9833</code></pre>
<p>Ashby’s example helps out a lot and should be used as a model of the workflow for studying <code>pitadtma</code>. Imputation will be necessary to work with that dataset, so I’ll return to the DataCamp course for that.</p>
</div>
</div>
<div id="imputation-discussion" class="section level2" number="18.2">
<h2><span class="header-section-number">18.2</span> Imputation discussion</h2>
<p>This example shows how to generate some missing values, and to use imputation overcome these.</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="moremodeling.html#cb763-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;mtcars&quot;</span>)</span>
<span id="cb763-2"><a href="moremodeling.html#cb763-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb763-3"><a href="moremodeling.html#cb763-3" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), <span class="dv">10</span>), <span class="st">&quot;hp&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb763-4"><a href="moremodeling.html#cb763-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> mtcars<span class="sc">$</span>mpg</span>
<span id="cb763-5"><a href="moremodeling.html#cb763-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> mtcars[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb763-6"><a href="moremodeling.html#cb763-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb763-7"><a href="moremodeling.html#cb763-7" aria-hidden="true" tabindex="-1"></a><span class="co"># model &lt;- train(X,Y) #This fails, because of the NAs. Try imputation.</span></span>
<span id="cb763-8"><a href="moremodeling.html#cb763-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb763-9"><a href="moremodeling.html#cb763-9" aria-hidden="true" tabindex="-1"></a>median_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb763-10"><a href="moremodeling.html#cb763-10" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb763-11"><a href="moremodeling.html#cb763-11" aria-hidden="true" tabindex="-1"></a>  Y,</span>
<span id="cb763-12"><a href="moremodeling.html#cb763-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">preProcess =</span> <span class="st">&quot;medianImpute&quot;</span></span>
<span id="cb763-13"><a href="moremodeling.html#cb763-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## note: only 2 unique complexity parameters in default grid. Truncating the grid to 2 .</code></pre>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="moremodeling.html#cb765-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(median_model)</span></code></pre></div>
<pre><code>## Random Forest 
## 
## 32 samples
##  3 predictor
## 
## Pre-processing: median imputation (3) 
## Resampling: Bootstrapped (25 reps) 
## Summary of sample sizes: 32, 32, 32, 32, 32, 32, ... 
## Resampling results across tuning parameters:
## 
##   mtry  RMSE      Rsquared   MAE     
##   2     2.758439  0.8106146  2.260273
##   3     2.729423  0.8123802  2.224138
## 
## RMSE was used to select the optimal model using the smallest value.
## The final value used for the model was mtry = 3.</code></pre>
<p>Data that is missing not at random offers special challenges.</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="moremodeling.html#cb767-1" aria-hidden="true" tabindex="-1"></a>mtcars[mtcars<span class="sc">$</span>disp <span class="sc">&lt;</span> <span class="dv">140</span>, <span class="st">&quot;hp&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb767-2"><a href="moremodeling.html#cb767-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> mtcars<span class="sc">$</span>mpg</span>
<span id="cb767-3"><a href="moremodeling.html#cb767-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> mtcars[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb767-4"><a href="moremodeling.html#cb767-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-5"><a href="moremodeling.html#cb767-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with median imputation:</span></span>
<span id="cb767-6"><a href="moremodeling.html#cb767-6" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb767-7"><a href="moremodeling.html#cb767-7" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb767-8"><a href="moremodeling.html#cb767-8" aria-hidden="true" tabindex="-1"></a>  Y,</span>
<span id="cb767-9"><a href="moremodeling.html#cb767-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb767-10"><a href="moremodeling.html#cb767-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">preProcess =</span> <span class="st">&quot;medianImpute&quot;</span></span>
<span id="cb767-11"><a href="moremodeling.html#cb767-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb767-12"><a href="moremodeling.html#cb767-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-13"><a href="moremodeling.html#cb767-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">min</span>(model<span class="sc">$</span>results<span class="sc">$</span>RMSE))</span></code></pre></div>
<pre><code>## [1] 3.437128</code></pre>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="moremodeling.html#cb769-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb769-2"><a href="moremodeling.html#cb769-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb769-3"><a href="moremodeling.html#cb769-3" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb769-4"><a href="moremodeling.html#cb769-4" aria-hidden="true" tabindex="-1"></a>  Y,</span>
<span id="cb769-5"><a href="moremodeling.html#cb769-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb769-6"><a href="moremodeling.html#cb769-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">&quot;knnImpute&quot;</span>)</span>
<span id="cb769-7"><a href="moremodeling.html#cb769-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb769-8"><a href="moremodeling.html#cb769-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb769-9"><a href="moremodeling.html#cb769-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">min</span>(model<span class="sc">$</span>results<span class="sc">$</span>RMSE))</span></code></pre></div>
<pre><code>## [1] 3.135958</code></pre>
</div>
<div id="multiple-preprocessing-methods" class="section level2" number="18.3">
<h2><span class="header-section-number">18.3</span> Multiple preprocessing methods</h2>
<p>Zach Mayer offers the following cheat sheet for preprocessing:</p>
<ul>
<li>Start with median imputation (if you’re using it)</li>
<li>Try KNN imputation if data NOT missing at random</li>
<li>For linear models (lm, glm, glmnet) always center and scale</li>
<li>Tree-based models (random forest, gbm) don’t need much preprocessing</li>
</ul>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="moremodeling.html#cb771-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;mtcars&quot;</span>)</span>
<span id="cb771-2"><a href="moremodeling.html#cb771-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb771-3"><a href="moremodeling.html#cb771-3" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), <span class="dv">10</span>), <span class="st">&quot;hp&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb771-4"><a href="moremodeling.html#cb771-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> mtcars<span class="sc">$</span>mpg</span>
<span id="cb771-5"><a href="moremodeling.html#cb771-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> mtcars[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="co"># missing at random</span></span>
<span id="cb771-6"><a href="moremodeling.html#cb771-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-7"><a href="moremodeling.html#cb771-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb771-8"><a href="moremodeling.html#cb771-8" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb771-9"><a href="moremodeling.html#cb771-9" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb771-10"><a href="moremodeling.html#cb771-10" aria-hidden="true" tabindex="-1"></a>  Y,</span>
<span id="cb771-11"><a href="moremodeling.html#cb771-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb771-12"><a href="moremodeling.html#cb771-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">&quot;medianImpute&quot;</span>, <span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>)</span>
<span id="cb771-13"><a href="moremodeling.html#cb771-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb771-14"><a href="moremodeling.html#cb771-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-15"><a href="moremodeling.html#cb771-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">min</span>(model<span class="sc">$</span>results<span class="sc">$</span>RMSE))</span></code></pre></div>
<pre><code>## [1] 3.079732</code></pre>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="moremodeling.html#cb773-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb773-2"><a href="moremodeling.html#cb773-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb773-3"><a href="moremodeling.html#cb773-3" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb773-4"><a href="moremodeling.html#cb773-4" aria-hidden="true" tabindex="-1"></a>  Y,</span>
<span id="cb773-5"><a href="moremodeling.html#cb773-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb773-6"><a href="moremodeling.html#cb773-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">&quot;medianImpute&quot;</span>, <span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>, <span class="st">&quot;pca&quot;</span>)</span>
<span id="cb773-7"><a href="moremodeling.html#cb773-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb773-8"><a href="moremodeling.html#cb773-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb773-9"><a href="moremodeling.html#cb773-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">min</span>(model<span class="sc">$</span>results<span class="sc">$</span>RMSE)) <span class="co"># with pca applied</span></span></code></pre></div>
<pre><code>## [1] 3.03581</code></pre>
</div>
<div id="handling-low-information-predictors" class="section level2" number="18.4">
<h2><span class="header-section-number">18.4</span> Handling low-information predictors</h2>
<p>Constant or nearly constant values mess up models, or at the very least provide little useful information. They are usually removed, at least when addressing balanced datasets. For imbalanced datasets, leaving near zero variance predictors in the dataset is probably advised.</p>
<p>NOTE: using PCA as a preprocessing step can accomplish much the same thing as removing near zero variance predictors, so is worth trying. See above for an example using PCA.</p>
</div>
<div id="max-kuhn-on-reusing-a-traincontrol" class="section level2" number="18.5">
<h2><span class="header-section-number">18.5</span> Max Kuhn on reusing a trainControl</h2>
<p>Note that the outcome (churn/no churn) is binary and that the dataset is somewhat imbalanced.</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="moremodeling.html#cb775-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(C50)</span>
<span id="cb775-2"><a href="moremodeling.html#cb775-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeldata)</span>
<span id="cb775-3"><a href="moremodeling.html#cb775-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mlc_churn)</span>
<span id="cb775-4"><a href="moremodeling.html#cb775-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb775-5"><a href="moremodeling.html#cb775-5" aria-hidden="true" tabindex="-1"></a>inTrainingSet <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(mlc_churn<span class="sc">$</span>churn, </span>
<span id="cb775-6"><a href="moremodeling.html#cb775-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">p =</span> <span class="fl">0.75</span>,</span>
<span id="cb775-7"><a href="moremodeling.html#cb775-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb775-8"><a href="moremodeling.html#cb775-8" aria-hidden="true" tabindex="-1"></a>churnTrain <span class="ot">&lt;-</span> mlc_churn[inTrainingSet,]</span>
<span id="cb775-9"><a href="moremodeling.html#cb775-9" aria-hidden="true" tabindex="-1"></a>churnTest <span class="ot">&lt;-</span> mlc_churn[<span class="sc">-</span>inTrainingSet,]</span>
<span id="cb775-10"><a href="moremodeling.html#cb775-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(churnTrain)</span></code></pre></div>
<pre><code>## Rows: 3,751
## Columns: 20
## $ state                         &lt;fct&gt; KS, NJ, OH, MA, LA, IN, RI, IA, IA, NY, …
## $ account_length                &lt;int&gt; 128, 137, 84, 121, 117, 65, 74, 168, 62,…
## $ area_code                     &lt;fct&gt; area_code_415, area_code_415, area_code_…
## $ international_plan            &lt;fct&gt; no, no, yes, no, no, no, no, no, no, no,…
## $ voice_mail_plan               &lt;fct&gt; yes, no, no, yes, no, no, no, no, no, no…
## $ number_vmail_messages         &lt;int&gt; 25, 0, 0, 24, 0, 0, 0, 0, 0, 0, 27, 0, 0…
## $ total_day_minutes             &lt;dbl&gt; 265.1, 243.4, 299.4, 218.2, 184.5, 129.1…
## $ total_day_calls               &lt;int&gt; 110, 114, 71, 88, 97, 137, 127, 96, 70, …
## $ total_day_charge              &lt;dbl&gt; 45.07, 41.38, 50.90, 37.09, 31.37, 21.95…
## $ total_eve_minutes             &lt;dbl&gt; 197.4, 121.2, 61.9, 348.5, 351.6, 228.5,…
## $ total_eve_calls               &lt;int&gt; 99, 110, 88, 108, 80, 83, 148, 71, 76, 9…
## $ total_eve_charge              &lt;dbl&gt; 16.78, 10.30, 5.26, 29.62, 29.89, 19.42,…
## $ total_night_minutes           &lt;dbl&gt; 244.7, 162.6, 196.9, 212.6, 215.8, 208.8…
## $ total_night_calls             &lt;int&gt; 91, 104, 89, 118, 90, 111, 94, 128, 99, …
## $ total_night_charge            &lt;dbl&gt; 11.01, 7.32, 8.86, 9.57, 9.71, 9.40, 8.8…
## $ total_intl_minutes            &lt;dbl&gt; 10.0, 12.2, 6.6, 7.5, 8.7, 12.7, 9.1, 11…
## $ total_intl_calls              &lt;int&gt; 3, 5, 7, 7, 4, 6, 5, 2, 6, 9, 4, 3, 2, 4…
## $ total_intl_charge             &lt;dbl&gt; 2.70, 3.29, 1.78, 2.03, 2.35, 3.43, 2.46…
## $ number_customer_service_calls &lt;int&gt; 1, 0, 2, 3, 1, 4, 0, 1, 4, 4, 1, 3, 1, 0…
## $ churn                         &lt;fct&gt; no, no, no, no, no, yes, no, no, no, yes…</code></pre>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="moremodeling.html#cb777-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(churnTest)</span></code></pre></div>
<pre><code>## Rows: 1,249
## Columns: 20
## $ state                         &lt;fct&gt; OH, OK, AL, MO, WV, MT, VA, AZ, SC, WY, …
## $ account_length                &lt;int&gt; 107, 75, 118, 147, 141, 95, 76, 130, 111…
## $ area_code                     &lt;fct&gt; area_code_415, area_code_415, area_code_…
## $ international_plan            &lt;fct&gt; no, yes, yes, yes, yes, no, no, no, no, …
## $ voice_mail_plan               &lt;fct&gt; yes, no, no, no, yes, no, yes, no, no, y…
## $ number_vmail_messages         &lt;int&gt; 26, 0, 0, 0, 37, 0, 33, 0, 0, 39, 33, 0,…
## $ total_day_minutes             &lt;dbl&gt; 161.6, 166.7, 223.4, 157.0, 258.6, 156.6…
## $ total_day_calls               &lt;int&gt; 123, 113, 98, 79, 84, 88, 66, 112, 103, …
## $ total_day_charge              &lt;dbl&gt; 27.47, 28.34, 37.98, 26.69, 43.96, 26.62…
## $ total_eve_minutes             &lt;dbl&gt; 195.5, 148.3, 220.6, 103.1, 222.0, 247.6…
## $ total_eve_calls               &lt;int&gt; 103, 122, 101, 94, 111, 75, 65, 99, 102,…
## $ total_eve_charge              &lt;dbl&gt; 16.62, 12.61, 18.75, 8.76, 18.87, 21.05,…
## $ total_night_minutes           &lt;dbl&gt; 254.4, 186.9, 203.9, 211.8, 326.4, 192.3…
## $ total_night_calls             &lt;int&gt; 103, 121, 118, 96, 97, 115, 108, 78, 105…
## $ total_night_charge            &lt;dbl&gt; 11.45, 8.41, 9.18, 9.53, 14.69, 8.65, 7.…
## $ total_intl_minutes            &lt;dbl&gt; 13.7, 10.1, 6.3, 7.1, 11.2, 12.3, 10.0, …
## $ total_intl_calls              &lt;int&gt; 3, 3, 6, 6, 5, 5, 5, 19, 6, 3, 6, 2, 5, …
## $ total_intl_charge             &lt;dbl&gt; 3.70, 2.73, 1.70, 1.92, 3.02, 3.32, 2.70…
## $ number_customer_service_calls &lt;int&gt; 1, 3, 0, 0, 0, 3, 1, 0, 2, 0, 3, 3, 3, 3…
## $ churn                         &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, …</code></pre>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="moremodeling.html#cb779-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(churnTrain<span class="sc">$</span>churn) <span class="sc">/</span> <span class="fu">nrow</span>(churnTrain)</span></code></pre></div>
<pre><code>## 
##       yes        no 
## 0.1415623 0.8584377</code></pre>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="moremodeling.html#cb781-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(churnTest<span class="sc">$</span>churn) <span class="sc">/</span> <span class="fu">nrow</span>(churnTest) </span></code></pre></div>
<pre><code>## 
##       yes        no 
## 0.1409127 0.8590873</code></pre>
<p>So the test and training sets have approximately equal proportions of churn.</p>
<p>Now, in order to reuse trainControl, it’s helpful to be certain that the model encounters exactly the same folds in cross validation.</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="moremodeling.html#cb783-1" aria-hidden="true" tabindex="-1"></a>myFolds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(churnTrain<span class="sc">$</span>churn, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb783-2"><a href="moremodeling.html#cb783-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare class distribution</span></span>
<span id="cb783-3"><a href="moremodeling.html#cb783-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb783-4"><a href="moremodeling.html#cb783-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> myFolds<span class="sc">$</span>Fold1</span>
<span id="cb783-5"><a href="moremodeling.html#cb783-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(churnTrain<span class="sc">$</span>churn[i]) <span class="sc">/</span> <span class="fu">length</span>(i)</span></code></pre></div>
<pre><code>## 
##       yes        no 
## 0.1413333 0.8586667</code></pre>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="moremodeling.html#cb785-1" aria-hidden="true" tabindex="-1"></a>myControl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb785-2"><a href="moremodeling.html#cb785-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> twoClassSummary,</span>
<span id="cb785-3"><a href="moremodeling.html#cb785-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>, <span class="co">#Important!  </span></span>
<span id="cb785-4"><a href="moremodeling.html#cb785-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">verboseIter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb785-5"><a href="moremodeling.html#cb785-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb785-6"><a href="moremodeling.html#cb785-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> myFolds</span>
<span id="cb785-7"><a href="moremodeling.html#cb785-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now that the folds and trainControl are established, we can go on to make some models.</p>
<p>First a glmnet model:</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="moremodeling.html#cb786-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb786-2"><a href="moremodeling.html#cb786-2" aria-hidden="true" tabindex="-1"></a>model_glmnet <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb786-3"><a href="moremodeling.html#cb786-3" aria-hidden="true" tabindex="-1"></a>    churn <span class="sc">~</span> .,</span>
<span id="cb786-4"><a href="moremodeling.html#cb786-4" aria-hidden="true" tabindex="-1"></a>    churnTrain,</span>
<span id="cb786-5"><a href="moremodeling.html#cb786-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb786-6"><a href="moremodeling.html#cb786-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;glmnet&quot;</span>,</span>
<span id="cb786-7"><a href="moremodeling.html#cb786-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tune.grid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb786-8"><a href="moremodeling.html#cb786-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb786-9"><a href="moremodeling.html#cb786-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">lambda =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb786-10"><a href="moremodeling.html#cb786-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb786-11"><a href="moremodeling.html#cb786-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> myControl</span>
<span id="cb786-12"><a href="moremodeling.html#cb786-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## + Fold1: alpha=0.10, lambda=0.01756 
## - Fold1: alpha=0.10, lambda=0.01756 
## + Fold1: alpha=0.55, lambda=0.01756 
## - Fold1: alpha=0.55, lambda=0.01756 
## + Fold1: alpha=1.00, lambda=0.01756 
## - Fold1: alpha=1.00, lambda=0.01756 
## + Fold2: alpha=0.10, lambda=0.01756 
## - Fold2: alpha=0.10, lambda=0.01756 
## + Fold2: alpha=0.55, lambda=0.01756 
## - Fold2: alpha=0.55, lambda=0.01756 
## + Fold2: alpha=1.00, lambda=0.01756 
## - Fold2: alpha=1.00, lambda=0.01756 
## + Fold3: alpha=0.10, lambda=0.01756 
## - Fold3: alpha=0.10, lambda=0.01756 
## + Fold3: alpha=0.55, lambda=0.01756 
## - Fold3: alpha=0.55, lambda=0.01756 
## + Fold3: alpha=1.00, lambda=0.01756 
## - Fold3: alpha=1.00, lambda=0.01756 
## + Fold4: alpha=0.10, lambda=0.01756 
## - Fold4: alpha=0.10, lambda=0.01756 
## + Fold4: alpha=0.55, lambda=0.01756 
## - Fold4: alpha=0.55, lambda=0.01756 
## + Fold4: alpha=1.00, lambda=0.01756 
## - Fold4: alpha=1.00, lambda=0.01756 
## + Fold5: alpha=0.10, lambda=0.01756 
## - Fold5: alpha=0.10, lambda=0.01756 
## + Fold5: alpha=0.55, lambda=0.01756 
## - Fold5: alpha=0.55, lambda=0.01756 
## + Fold5: alpha=1.00, lambda=0.01756 
## - Fold5: alpha=1.00, lambda=0.01756 
## Aggregating results
## Selecting tuning parameters
## Fitting alpha = 1, lambda = 0.0176 on full training set</code></pre>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="moremodeling.html#cb788-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_glmnet)</span></code></pre></div>
<p><img src="test-book_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="moremodeling.html#cb789-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_glmnet<span class="sc">$</span>finalModel)</span></code></pre></div>
<p><img src="test-book_files/figure-html/unnamed-chunk-164-2.png" width="672" /></p>
<p>Let’s try a random forest model.</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="moremodeling.html#cb790-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb790-2"><a href="moremodeling.html#cb790-2" aria-hidden="true" tabindex="-1"></a>churnTrain<span class="sc">$</span>churn <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb790-3"><a href="moremodeling.html#cb790-3" aria-hidden="true" tabindex="-1"></a>  churnTrain<span class="sc">$</span>churn, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;no&quot;</span>, <span class="st">&quot;yes&quot;</span>)</span>
<span id="cb790-4"><a href="moremodeling.html#cb790-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb790-5"><a href="moremodeling.html#cb790-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-6"><a href="moremodeling.html#cb790-6" aria-hidden="true" tabindex="-1"></a>model_rf <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb790-7"><a href="moremodeling.html#cb790-7" aria-hidden="true" tabindex="-1"></a>    churn <span class="sc">~</span> .,</span>
<span id="cb790-8"><a href="moremodeling.html#cb790-8" aria-hidden="true" tabindex="-1"></a>    churnTrain,</span>
<span id="cb790-9"><a href="moremodeling.html#cb790-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb790-10"><a href="moremodeling.html#cb790-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb790-11"><a href="moremodeling.html#cb790-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> myControl</span>
<span id="cb790-12"><a href="moremodeling.html#cb790-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## + Fold1: mtry= 2, min.node.size=1, splitrule=gini 
## - Fold1: mtry= 2, min.node.size=1, splitrule=gini 
## + Fold1: mtry=35, min.node.size=1, splitrule=gini 
## - Fold1: mtry=35, min.node.size=1, splitrule=gini 
## + Fold1: mtry=69, min.node.size=1, splitrule=gini 
## - Fold1: mtry=69, min.node.size=1, splitrule=gini 
## + Fold1: mtry= 2, min.node.size=1, splitrule=extratrees 
## - Fold1: mtry= 2, min.node.size=1, splitrule=extratrees 
## + Fold1: mtry=35, min.node.size=1, splitrule=extratrees 
## - Fold1: mtry=35, min.node.size=1, splitrule=extratrees 
## + Fold1: mtry=69, min.node.size=1, splitrule=extratrees 
## - Fold1: mtry=69, min.node.size=1, splitrule=extratrees 
## + Fold2: mtry= 2, min.node.size=1, splitrule=gini 
## - Fold2: mtry= 2, min.node.size=1, splitrule=gini 
## + Fold2: mtry=35, min.node.size=1, splitrule=gini 
## - Fold2: mtry=35, min.node.size=1, splitrule=gini 
## + Fold2: mtry=69, min.node.size=1, splitrule=gini 
## - Fold2: mtry=69, min.node.size=1, splitrule=gini 
## + Fold2: mtry= 2, min.node.size=1, splitrule=extratrees 
## - Fold2: mtry= 2, min.node.size=1, splitrule=extratrees 
## + Fold2: mtry=35, min.node.size=1, splitrule=extratrees 
## - Fold2: mtry=35, min.node.size=1, splitrule=extratrees 
## + Fold2: mtry=69, min.node.size=1, splitrule=extratrees 
## - Fold2: mtry=69, min.node.size=1, splitrule=extratrees 
## + Fold3: mtry= 2, min.node.size=1, splitrule=gini 
## - Fold3: mtry= 2, min.node.size=1, splitrule=gini 
## + Fold3: mtry=35, min.node.size=1, splitrule=gini 
## - Fold3: mtry=35, min.node.size=1, splitrule=gini 
## + Fold3: mtry=69, min.node.size=1, splitrule=gini 
## - Fold3: mtry=69, min.node.size=1, splitrule=gini 
## + Fold3: mtry= 2, min.node.size=1, splitrule=extratrees 
## - Fold3: mtry= 2, min.node.size=1, splitrule=extratrees 
## + Fold3: mtry=35, min.node.size=1, splitrule=extratrees 
## - Fold3: mtry=35, min.node.size=1, splitrule=extratrees 
## + Fold3: mtry=69, min.node.size=1, splitrule=extratrees 
## - Fold3: mtry=69, min.node.size=1, splitrule=extratrees 
## + Fold4: mtry= 2, min.node.size=1, splitrule=gini 
## - Fold4: mtry= 2, min.node.size=1, splitrule=gini 
## + Fold4: mtry=35, min.node.size=1, splitrule=gini 
## - Fold4: mtry=35, min.node.size=1, splitrule=gini 
## + Fold4: mtry=69, min.node.size=1, splitrule=gini 
## - Fold4: mtry=69, min.node.size=1, splitrule=gini 
## + Fold4: mtry= 2, min.node.size=1, splitrule=extratrees 
## - Fold4: mtry= 2, min.node.size=1, splitrule=extratrees 
## + Fold4: mtry=35, min.node.size=1, splitrule=extratrees 
## - Fold4: mtry=35, min.node.size=1, splitrule=extratrees 
## + Fold4: mtry=69, min.node.size=1, splitrule=extratrees 
## - Fold4: mtry=69, min.node.size=1, splitrule=extratrees 
## + Fold5: mtry= 2, min.node.size=1, splitrule=gini 
## - Fold5: mtry= 2, min.node.size=1, splitrule=gini 
## + Fold5: mtry=35, min.node.size=1, splitrule=gini 
## - Fold5: mtry=35, min.node.size=1, splitrule=gini 
## + Fold5: mtry=69, min.node.size=1, splitrule=gini 
## - Fold5: mtry=69, min.node.size=1, splitrule=gini 
## + Fold5: mtry= 2, min.node.size=1, splitrule=extratrees 
## - Fold5: mtry= 2, min.node.size=1, splitrule=extratrees 
## + Fold5: mtry=35, min.node.size=1, splitrule=extratrees 
## - Fold5: mtry=35, min.node.size=1, splitrule=extratrees 
## + Fold5: mtry=69, min.node.size=1, splitrule=extratrees 
## - Fold5: mtry=69, min.node.size=1, splitrule=extratrees 
## Aggregating results
## Selecting tuning parameters
## Fitting mtry = 35, splitrule = extratrees, min.node.size = 1 on full training set</code></pre>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb792-1"><a href="moremodeling.html#cb792-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_rf)</span></code></pre></div>
<p><img src="test-book_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
</div>
<div id="comparing-models" class="section level2" number="18.6">
<h2><span class="header-section-number">18.6</span> Comparing models</h2>
<p>Fundamental to this is making sure that the models were fit on exactly the same data! We select the model with the highest AUC and the lowest standard deviation in AUC.</p>
<p>The <strong>resamples()</strong> function is very useful.</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="moremodeling.html#cb793-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, make a list</span></span>
<span id="cb793-2"><a href="moremodeling.html#cb793-2" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb793-3"><a href="moremodeling.html#cb793-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">glmnet =</span> model_glmnet,</span>
<span id="cb793-4"><a href="moremodeling.html#cb793-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rf =</span> model_rf</span>
<span id="cb793-5"><a href="moremodeling.html#cb793-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb793-6"><a href="moremodeling.html#cb793-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-7"><a href="moremodeling.html#cb793-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect resamples from the CV folds</span></span>
<span id="cb793-8"><a href="moremodeling.html#cb793-8" aria-hidden="true" tabindex="-1"></a>resamps <span class="ot">&lt;-</span> <span class="fu">resamples</span>(model_list)</span>
<span id="cb793-9"><a href="moremodeling.html#cb793-9" aria-hidden="true" tabindex="-1"></a>resamps</span></code></pre></div>
<pre><code>## 
## Call:
## resamples.default(x = model_list)
## 
## Models: glmnet, rf 
## Number of resamples: 5 
## Performance metrics: ROC, Sens, Spec 
## Time estimates for: everything, final model fit</code></pre>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="moremodeling.html#cb795-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb795-2"><a href="moremodeling.html#cb795-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resamps)</span></code></pre></div>
<pre><code>## 
## Call:
## summary.resamples(object = resamps)
## 
## Models: glmnet, rf 
## Number of resamples: 5 
## 
## ROC 
##             Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA&#39;s
## glmnet 0.7813141 0.8045259 0.8045561 0.8015931 0.8076270 0.8099425    0
## rf     0.8991007 0.9073443 0.9096319 0.9114213 0.9187639 0.9222657    0
## 
## Sens 
##              Min.    1st Qu.    Median       Mean   3rd Qu.      Max. NA&#39;s
## glmnet 0.04705882 0.09647059 0.1152941 0.09934961 0.1179245 0.1200000    0
## rf     0.98330745 0.98486025 0.9918478 0.98913043 0.9922360 0.9934006    0
## 
## Spec 
##             Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA&#39;s
## glmnet 0.9798137 0.9802019 0.9860248 0.9851708 0.9871894 0.9926242    0
## rf     0.5082353 0.5105882 0.5270588 0.5282664 0.5294118 0.5660377    0</code></pre>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="moremodeling.html#cb797-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bwplot</span>(resamps)</span></code></pre></div>
<p><img src="test-book_files/figure-html/unnamed-chunk-166-1.png" width="672" /></p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="moremodeling.html#cb798-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bwplot</span>(resamps, <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>)</span></code></pre></div>
<p><img src="test-book_files/figure-html/unnamed-chunk-166-2.png" width="672" /></p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="moremodeling.html#cb799-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The dotplot is the most elegant way to compare the performance of multiple models</span></span>
<span id="cb799-2"><a href="moremodeling.html#cb799-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot</span>(resamps, <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>)</span></code></pre></div>
<p><img src="test-book_files/figure-html/unnamed-chunk-166-3.png" width="672" /></p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="moremodeling.html#cb800-1" aria-hidden="true" tabindex="-1"></a><span class="fu">densityplot</span>(resamps, <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>)</span></code></pre></div>
<p><img src="test-book_files/figure-html/unnamed-chunk-166-4.png" width="672" /></p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="moremodeling.html#cb801-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(resamps, <span class="at">metric =</span> <span class="st">&quot;ROC&quot;</span>)</span></code></pre></div>
<p><img src="test-book_files/figure-html/unnamed-chunk-166-5.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modeling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="github.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/18modeling2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["test-book.pdf", "test-book.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
