---
title: "Bill's Drills Book"
author: "William McDonald"
date: "`r Sys.Date()`"
output: bookdown::gitbook
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: https://github.com/wliammd/billsDrills
---

# Drills: Part of Every Healthy Intellectual Diet {#intro}

The goal of this book is to organize my R drills into reasonable chunks, the better to understand my strengths and weaknesses, and to plan new forays into data science.

Notes on **bookdown**: 

  * the `_bookdown.yml` file contains a snippet that is important to inserting the word "Chapter" before the chapter number in each of the Rmd files. 
  * packages are indicated in bold, like **dplyr**
  * inline code and filenames are indicated in typerwriter face, like `_bookdown.yml`
  * `_output.yml` is modified from that used by Xie in his `bookdown-demo` [@R-bookdown]; it evokes `style.css`, `toc.css`, `preamble.tex`, which are also borrowed from Xie. 

<!--chapter:end:index.Rmd-->

# Data Exploration {#dataexploration}

Data exploration is one of the most important aspects of data science and forms the cornerstone of my drills. Nonetheless, I have lots of room for improvement.

I like Hadely Wickham's writing and find his approach exceptionally clear. Therefore, I'll use the *tidyverse*. 

```{r, message=FALSE}
library(tidyverse)
```

## Counting things. The naming of parts. 

```{r starfig-1, fig.cap='Starwars Figure 1'}
starwars %>% 
  filter(!is.na(species)) %>% 
  count(species = fct_lump(species, 5), sort = TRUE) %>% 
  mutate(species = fct_reorder(species, n)) %>% 
  ggplot(aes(species, n)) + 
  geom_col() + coord_flip()
```

I like stacked bars for their economy, but it's easy to over do it. Supperimposing gender onto the columns seems easy...

```{r}
starwars %>% 
  filter(!is.na(species)) %>% 
  count(species = fct_lump(species, 5), gender = fct_lump(gender, 2), sort = TRUE) %>% 
  mutate(species = fct_reorder(species, n)) %>% 
  ggplot(aes(species, n, fill = gender)) + 
  geom_col() + coord_flip()
```

But note that I've got a problem: the Droids, which outnumber the Gungans, are now reordered to _after_ the Gungans. This happens because the $n$ that we're counting comprises subcategories of species _and_ gender.  Only three Gungan males exist (and no females), but that is enough to tie the Droid NA category. The Droid NA category come after the Gungan category, presumably because _male_ comes before _NA_, or because NA comes last (more likely). 

Exploring this, I see that I'm getting warning messages about the implicit NA's in gender. Note that the following renders a slightly different plot. I _still_ have not fixed the order of the species. 


```{r}
starwars %>% 
  filter(!is.na(species)) %>% 
  count(species = fct_lump(species, 5), gender = fct_lump(gender, 2), sort = TRUE) %>% 
  mutate(gender = fct_explicit_na(gender),
         species = fct_reorder(species, n)) %>% 
  ggplot(aes(species, n, fill = gender)) + 
  geom_col() + coord_flip()
```

## Summarize is another very useful function:

```{r}
starwars %>% 
  filter(!(is.na(species))) %>% 
  group_by(species) %>% 
  summarize(n=n(), mean = mean(height, na.rm = TRUE)) %>% 
  arrange(desc(n))
```

## Referencing other parts of the document

This is a good place to practice referencing figures. Say that I want to refer the reader back to my first starwars figure. See Figure \@ref(fig:starfig-1).

I can reference other pages in a similar fashion. See Chapter \@ref(subset). Note that this works by referencing a {#label} placed in the chapter title. 

See Chapter \@ref(intro)

See Chapter \@ref(dataexploration)

Note that the {#label} uses a single run-together word. It does not tolerate spaces and this cannot be overcome by 'quoting' it. 

## Referencing citations:

In order to insert citations, one needs a .bib file in the project. I've included one in this project as *book.bib*. The yml header in Chapter \@ref(intro) needs to have a $bibliography:$ and $biblio-style:$ line added. 

To insert a citation, use the **citr** Addin from RStudio. **bookdown**, for instance, is cited thusly [@R-bookdown]. Note that I need to figure out an adequate workflow of references. The convenience of Endnote in MS Word will not be available. Nonetheless, if I populate the book.bib and packages.bib files carefully, with .txt files generated in Endnote, I should be OK.

For instance, a recent dump of my Endnote library is in bookFromEndnote.txt. This can be opened in RStudio, and I can copy-and-paste references from the .txt file to my book.bib. For instance, if I have a breast paper that I want to cite here [@RN2750], I'd copy-and-paste the reference from bookFromEndnot.text to book.bib. 

Of note, Yihui Xie includes a nifty bit of code to automatically generate a bib database for R packages:

```{r}
knitr::write_bib(c(.packages(), 'bookdown', 'knitr', 'rmarkdown', 'tidyverse', 'ComplexHeatmap'), 'packages.bib')
```


References appear automatically at the end of a chapter. 

<!--chapter:end:01chpter.Rmd-->

# Sampling

## Think about throwing a bunch of dice.

```{r}
sample(1:6, size=100, replace=TRUE) 
sample(1:6, size=100, replace=TRUE) %>% table()
sample(1:6, size=100, replace=TRUE) %>% table() %>% prop.table()
```

## A keen way to divide up a dataset into testing and training components. 
```{r}
x <- 1:50
y <- 51:100

df <- data.frame(x,y)
df

set.seed(0)
train_indexes = sample(1:nrow(df), .7 * nrow(df))

train_set <- df[train_indexes,]
test_set <- df[-train_indexes,]
```



<!--chapter:end:02chpter.Rmd-->

# Factor Practice

```{r}
cups <- c("small", "medium", "large")
manyCups <- sample(cups, size = 100, replace = TRUE)
sizesCups <- factor(manyCups, levels = c("small", "medium", "large"))
sizesCups
```

<!--chapter:end:03chpter.Rmd-->

# Crossing Trial

From David Robinson birthday paradox Rblogger at <https://www.r-bloggers.com/the-birthday-paradox-puzzle-tidy-simulation-in-r/>

```{r}
summarized <- crossing(people = seq(2, 50, 2),
                       trial = 1:100) %>%
  mutate(birthday = map(people, ~ sample(365, .x, replace = TRUE)),
         multiple = map_lgl(birthday, ~ any(duplicated(.x)))) %>%
  group_by(people) %>%
  summarize(chance = mean(multiple))

ggplot(summarized, aes(people, chance)) +
  geom_line() +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(y = "Probability two have the same birthday")

# Checking the work with pbirthday function
summarized %>% 
  mutate(exact = map_dbl(people, pbirthday)) %>% 
  ggplot(aes(people, chance)) +
  geom_line() +
  geom_line(aes(y = exact), lty = 2, color = "blue") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(y = "Probability two have the same birthday")
```


<!--chapter:end:04chpter.Rmd-->

# By Any Other Name

This deceptively simple-seeming idea gets complex quickly. The following YouTube was a nice description of the process: <https://www.youtube.com/watch?v=Okc0IL5uTnA>

```{r}
my.data <- data.frame(colOne=1:3, column2=4:6, column_3=7:9)
rownames(my.data) <- c("ant", "bee", "cat")
names(my.data)
colnames(my.data)

#make some changes
names(my.data) <- c("col_1", "col_2", "col_3")
my.data
names(my.data)[3] <- "col.3"
my.data

names(my.data)[names(my.data)=="col_2"]
my.data["col_2"]
my.data$col_2
my.data[,2]

names(my.data)[names(my.data)=="col_2"] <- "col.2"
my.data

names(my.data) <- gsub("_", ".", names(my.data))
my.data

rownames(my.data)
my.data$species <- rownames(my.data)
my.data
rownames(my.data) <- NULL
my.data
colnames(my.data) <- c("good", "better", "best", "species")
my.data

keep <- 2:ncol(my.data)
my.data[,keep]
```


<!--chapter:end:05chpter.Rmd-->

# Correlation Plots

```{r}
iris
iris %>% select(-Species) %>% cor()

M <- iris %>% select(-Species) %>% cor(method = "kendall")
```

```{r}
corrplot::corrplot(M)
corrplot::corrplot(M, method = "color")
corrplot::corrplot(M, method = "color", type = "upper")
corrplot::corrplot(M, method = "color", type = "upper", order = "hclust")
corrplot::corrplot(M, method = "color", type = "upper", order = "hclust", addCoef.col = "black")
corrplot::corrplot(M, method = "color", type = "upper", order = "hclust", addCoef.col = "black", tl.col="black")
corrplot::corrplot(M, method = "color", type = "upper", order = "hclust", addCoef.col = "black", tl.col="black", tl.srt = 45)
```





<!--chapter:end:06chpter.Rmd-->

# if_else() and case_when(): Comparison

## case_when()

case_when() from <https://www.rdocumentation.org/packages/dplyr/versions/0.7.8/topics/case_when>

```{r}
x <- 1:50
y <- 51:100

df <- data.frame(x,y)
df

case_when(
  x %% 35 == 0 ~ "fizz buzz",
  x %% 5 == 0 ~ "fizz",
  x %% 7 == 0 ~ "buzz",
  TRUE ~ as.character(x)
)
```


## Compare this with if_else()
```{r}
if_else(x %% 2 == 0, "even", "odd")
```




<!--chapter:end:07chpter.Rmd-->

# Subsetting {#subset}

From <https://www.r-bloggers.com/5-ways-to-subset-a-data-frame-in-r/>

Note: since this is down for maintenance, I will turn off evaluation on these chunks: 

```{r eval=FALSE}
education <- read.csv("https://vincentarelbundock.github.io/Rdatasets/csv/robustbase/education.csv", stringsAsFactors = FALSE)

colnames(education) <- c("X","State","Region","Urban.Population","Per.Capita.Income","Minor.Population","Education.Expenditures")

glimpse(education)

```

## Subsetting using brackets

```{r eval=FALSE}

ed_exp1 <- education[c(10:21),c(2,6:7)]

```

## Subset using brackets by omitting the rows and columns we donâ€™t want

```{r eval=FALSE}
ed_exp2 <- education[-c(1:9,22:50),-c(1,3:5)]
```

## Subset using brackets in combination with the which() function and the %in% operator

```{r eval=FALSE}
ed_exp3 <- education[which(education$Region == 2),names(education) %in% c("State","Minor.Population","Education.Expenditures")]
```

## Subset using the subset() function

```{r eval=FALSE}
ed_exp4 <- subset(education, Region == 2, select = c("State","Minor.Population","Education.Expenditures"))
```

## Subset using dyplyr's filter() and select()

```{r eval=FALSE}
ed_exp5 <- select(filter(education, Region == 2),c(State,Minor.Population:Education.Expenditures))
```




<!--chapter:end:08chpter.Rmd-->

`r if (knitr:::is_html_output()) '# References {-}'`

<!--chapter:end:10references.Rmd-->

