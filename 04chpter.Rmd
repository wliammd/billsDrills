# Factor Practice {#factorpractice}

```{r include=FALSE}
library(tidyverse)
```

## The basic structure

Let's say that you have 100 cups of sizes small, medium, or large. 

```{r}
cups <- c("small", "medium", "large")
set.seed(2020)
manyCups <- sample(cups, size = 100, replace = TRUE)
table(manyCups)
str(manyCups)
```

Note that `table()` renders these in alphabetical order. It's usually more useful to render them in order of magnitude by setting levels. 

```{r}
sizesCups <- factor(manyCups, levels = c("small", "medium", "large"))
sizesCups
table(sizesCups)
levels(sizesCups)
levels(many)
```

The **forcats** package is designed to work with factors. Although I use it frequently, I haven't generalized the ideas, or internalized them. That's a mistake. The RStudio cheat sheet is a nice place to begin with this: <https://rstudio.com/resources/cheatsheets/>. 

Let's use my favorite **starwars** illustration to help illustrate some of **forcats**'s usefulness.

```{r}
starwars %>% 
  filter(!is.na(species)) %>% 
  count(species, sort = TRUE)
```

The **forcats** cheat sheet contains a bunch of often-used functions that I rarely take the time to think about. 

## Not all nominal data is a factor

Note that many categorical variables are not encoded as factors. This has certain advantages, since levels can sometimes be seen as complicating ballast that is dragged around by the variable. 

See, so instance, that the `species` variable is not encoded as a factor:

```{r}
class(starwars$species)
```

See? `species` is character, not factor, class.

## Making variables into factors

The `factor()` function (or the `as_factor()` function) make a variable into a factor and allow the assignation of levels. 

```{r}
class(factor(starwars$species))
```

The `levels()` function is useful for returning these levels:

```{r}
levels(factor(starwars$species))
```

`levels()` can also be used to set the levels.

And additional structure can be observed with `unclass()`. Note that the default level order in `species` is alphabetical. 

```{r}
unclass(factor(starwars$species))
```


## Inspecting factors

We see that there are a ton of unique species in this list. 

```{r}
fct_count(starwars$species, sort = TRUE)

fct_unique(factor(starwars$species))

```

## fct_lump()

We often don't want to see all of the rare outcomes for a nominal variable, and are content to *lump* the uncommon ones together in an `other` category.

```{r}
starwars %>% filter(!is.na(species)) %>% 
  mutate(species = fct_lump(species, 5)) %>%
  count(species, sort = TRUE)
```

`fct_lump()` is will produce more than the requested number of categories (in this case 5), when ties are present in the last place. In this case, since 5 species each have 2 members, all of these species are listed. 