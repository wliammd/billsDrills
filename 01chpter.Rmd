# bookdown Tips for This Document {#bookdownplan}
```{r include=FALSE}
library(tidyverse)
```

## Basic conventions 
  * the `_bookdown.yml` file contains a snippet that is important to inserting the word "Chapter" before the chapter number in each of the Rmd files. 
  * packages are indicated in bold, like **dplyr** (surround with double asterisks)
  * programs, like RStudio or MS Word, are in regular typeface
  * inline code and filenames are indicated in typerwriter face by surrounding with backticks: `_bookdown.yml`
  * `_output.yml` is modified from that used by Xie in his `bookdown-demo` [@R-bookdown]; it evokes `style.css`, `toc.css`, `preamble.tex`, which are also borrowed from Xie. 
  * chapters are set in order by using adding 01, 02, 03, ... before the name of their Rmd, like `01chpter.Rmd`. Note that they can have short descriptive phrases, since the actual chapter titles are determined by the hashtag. `index.Rmd` always comes first in the book build, and contains the `yml` front matter. 
  * the most frequently used keyboard shortcuts from RStudio include:
    + Option-Hyphen (the assignment operator)
    + Shift-Control-c (comment code hashtag)
    + Option-Command-i (code chunk)
    + Shift-Control-m (pipe)

## Referencing other parts of the document

This is a good place to practice referencing figures. Say that I want to refer the reader back to my first starwars figure. See Figure \@ref(fig:starfig-1).

I can reference other pages in a similar fashion. See Chapter \@ref(subset). Note that this works by referencing a {#label} placed in the chapter title. 

See Chapter \@ref(intro)

See Chapter \@ref(dataexploration)

Note that the {#label} uses a single run-together word. It does not tolerate spaces and this cannot be overcome by 'quoting' it. 

## Inserting pictures

Pictures can be included in the `test-book_files` subdirectories and referenced like this: 

![Tpit immunohistochemical stain. Figure A silent corticotroph. Figure B gonadotroph](_bookdown_files/pathologyImages/TpitIHC.jpg)

Some of the subdirectories throw an error in building the book, so I settled on `_bookdown_files/pathologyImages` as the location.

Also, I note that the build does not generate the caption unless the reference is on it's own line. 

Also note that some controls on image size are available. For instance, the same image can be displayed at 50% size:

![Tpit immunohistochemical stain. Figure A silent corticotroph. Figure B gonadotroph](_bookdown_files/pathologyImages/TpitIHC.jpg){#id .class width=50% height=50%}
## Referencing citations:

In order to insert citations, one needs a .bib file in the project. I've included one in this project as `book.bib`. The yml header in Chapter \@ref(intro) needs to have a $bibliography:$ and $biblio-style:$ line added. 

To insert a citation, use the **citr** Addin from RStudio. **bookdown**, for instance, is cited thusly [@R-bookdown]. Note that I need to figure out an adequate workflow of references. The convenience of Endnote in MS Word will not be available. Nonetheless, if I populate the book.bib and packages.bib files carefully, with .txt files generated in Endnote, I should be OK.

For instance, a recent dump of my Endnote library is in bookFromEndnote.txt. This can be opened in RStudio, and I can copy-and-paste references from the .txt file to my book.bib. For instance, if I have a breast paper that I want to cite here [@RN2750], I'd copy-and-paste the reference from `bookFromEndnote.txt` to `book.bib`.

Of note, Yihui Xie includes a nifty bit of code to automatically generate a bib database for R packages:

```{r}
knitr::write_bib(c(.packages(), 'bookdown', 'knitr', 'rmarkdown', 'tidyverse', 'ComplexHeatmap'), 'packages.bib')
```

All packages are maintained in `packages.bib`. In the knitted document, references appear automatically at the end of a chapter. 

## Nifty test figure.

First I need the help of the **tidverse**.

```{r loadTidyverse, message=FALSE, warning=FALSE}
library(tidyverse)
```

Now to generate a figure. The code chunk contains the following: `{r starfig-1, fig.cap='Starwars Figure 1'}`. This labels the figure with a short name, *starfig-1*, and gives it the caption *Starwars Figure 1*. 

```{r starfig-1, fig.cap='Starwars Figure 1'}
starwars %>% filter(!is.na(species)) %>% 
  mutate(species = fct_lump(species, 5)) %>% 
  mutate(species = species %>% fct_infreq() %>% fct_rev()) %>% 
  ggplot()+
  geom_bar(aes(species, fill = gender))+
  coord_flip()
```


References appear automatically at the end of a chapter. 
